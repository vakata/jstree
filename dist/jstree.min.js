/*! jsTree - v3.0.2 - 2014-07-30 - (MIT) */
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(jQuery)}})(function(e,t){"use strict";if(e.jstree){return}var n=0,r=false,i=false,s=false,o=[],u=e("script:last").attr("src"),a=document,f=a.createElement("LI"),l,c;f.setAttribute("role","treeitem");l=a.createElement("I");l.className="jstree-icon jstree-ocl";f.appendChild(l);l=a.createElement("A");l.className="jstree-anchor";l.setAttribute("href","#");c=a.createElement("I");c.className="jstree-icon jstree-themeicon";l.appendChild(c);f.appendChild(l);l=c=null;e.jstree={version:"3.0.2",defaults:{plugins:[]},plugins:{},path:u&&u.indexOf("/")!==-1?u.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g};e.jstree.create=function(t,r){var i=new e.jstree.core(++n),s=r;r=e.extend(true,{},e.jstree.defaults,r);if(s&&s.plugins){r.plugins=s.plugins}e.each(r.plugins,function(e,t){if(e!=="core"){i=i.plugin(t,r[t])}});i.init(t,r);return i};e.jstree.core=function(e){this._id=e;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:false,dots:false,icons:false},selected:[],last_error:{},working:false,worker_queue:[]}}};e.jstree.reference=function(t){var n=null,r=null;if(t&&t.id){t=t.id}if(!r||!r.length){try{r=e(t)}catch(i){}}if(!r||!r.length){try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(i){}}if(r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))){n=r}else{e(".jstree").each(function(){var r=e(this).data("jstree");if(r&&r._model.data[t]){n=r;return false}})}return n};e.fn.jstree=function(n){var r=typeof n==="string",i=Array.prototype.slice.call(arguments,1),s=null;this.each(function(){var o=e.jstree.reference(this),u=r&&o?o[n]:null;s=r&&u?u.apply(o,i):null;if(!o&&!r&&(n===t||e.isPlainObject(n))){e(this).data("jstree",new e.jstree.create(this,n))}if(o&&!r||n===true){s=o||false}if(s!==null&&s!==t){return false}});return s!==null&&s!==t?s:this};e.expr[":"].jstree=e.expr.createPseudo(function(n){return function(n){return e(n).hasClass("jstree")&&e(n).data("jstree")!==t}});e.jstree.defaults.core={data:false,strings:false,check_callback:false,error:e.noop,animation:200,multiple:true,themes:{name:false,url:false,dir:false,dots:true,icons:true,stripes:false,variant:false,responsive:false},expand_selected_onload:true,worker:true,force_text:false};e.jstree.core.prototype={plugin:function(t,n){var r=e.jstree.plugins[t];if(r){this._data[t]={};r.prototype=this;return new r(n,this)}return this},init:function(t,n){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}},changed:[],force_full_redraw:false,redraw_timeout:false,default_state:{loaded:true,opened:false,selected:false,disabled:false}};this.element=e(t).addClass("jstree jstree-"+this._id);this.settings=n;this.element.bind("destroyed",e.proxy(this.teardown,this));this._data.core.ready=false;this._data.core.loaded=false;this._data.core.rtl=this.element.css("direction")==="rtl";this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(true);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<"+"ul class='jstree-container-ul jstree-children'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24;this.trigger("loading");this.load_node("#")},destroy:function(e){if(!e){this.element.empty()}this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges();e.collapse()}catch(t){}}}}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault();e(t.currentTarget).focus();this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName==="INPUT"){return true}var n=null;switch(t.which){case 13:case 32:t.type="click";e(t.currentTarget).trigger(t);break;case 37:t.preventDefault();if(this.is_open(t.currentTarget)){this.close_node(t.currentTarget)}else{n=this.get_prev_dom(t.currentTarget);if(n&&n.length){n.children(".jstree-anchor").focus()}}break;case 38:t.preventDefault();n=this.get_prev_dom(t.currentTarget);if(n&&n.length){n.children(".jstree-anchor").focus()}break;case 39:t.preventDefault();if(this.is_closed(t.currentTarget)){this.open_node(t.currentTarget,function(e){this.get_node(e,true).children(".jstree-anchor").focus()})}else{n=this.get_next_dom(t.currentTarget);if(n&&n.length){n.children(".jstree-anchor").focus()}}break;case 40:t.preventDefault();n=this.get_next_dom(t.currentTarget);if(n&&n.length){n.children(".jstree-anchor").focus()}break;case 46:t.preventDefault();n=this.get_node(t.currentTarget);if(n&&n.id&&n.id!=="#"){n=this.is_selected(n)?this.get_selected():n}break;case 113:t.preventDefault();n=this.get_node(t.currentTarget);break;default:break}},this)).on("load_node.jstree",e.proxy(function(t,n){if(n.status){if(n.node.id==="#"&&!this._data.core.loaded){this._data.core.loaded=true;this.trigger("loaded")}if(!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length){this._data.core.ready=true;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var r=[],i,s;for(i=0,s=this._data.core.selected.length;i<s;i++){r=r.concat(this._model.data[this._data.core.selected[i]].parents)}r=e.vakata.array_unique(r);for(i=0,s=r.length;i<s;i++){this.open_node(r[i],false,0)}}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(e.proxy(function(){this.trigger("ready")},this),0)}}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots;this._data.core.themes.stripes=e.stripes;this._data.core.themes.icons=e.icons;this.set_theme(e.name||"default",e.url);this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){e(t.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave();e(t.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree");e(document).off(".jstree-"+this._id)},trigger:function(e,t){if(!t){t={}}t.instance=this;this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(t){var n=this.settings.core.strings;if(e.isFunction(n)){return n.call(this,t)}if(n&&n[t]){return n[t]}return t},_firstChild:function(e){e=e?e.firstChild:null;while(e!==null&&e.nodeType!==1){e=e.nextSibling}return e},_nextSibling:function(e){e=e?e.nextSibling:null;while(e!==null&&e.nodeType!==1){e=e.nextSibling}return e},_previousSibling:function(e){e=e?e.previousSibling:null;while(e!==null&&e.nodeType!==1){e=e.previousSibling}return e},get_node:function(t,n){if(t&&t.id){t=t.id}var r;try{if(this._model.data[t]){t=this._model.data[t]}else if(((r=e(t,this.element)).length||(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[r.closest(".jstree-node").attr("id")]){t=this._model.data[r.closest(".jstree-node").attr("id")]}else if((r=e(t,this.element)).length&&r.hasClass("jstree")){t=this._model.data["#"]}else{return false}if(n){t=t.id==="#"?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)}return t}catch(i){return false}},get_path:function(e,t,n){e=e.parents?e:this.get_node(e);if(!e||e.id==="#"||!e.parents){return false}var r,i,s=[];s.push(n?e.id:e.text);for(r=0,i=e.parents.length;r<i;r++){s.push(n?e.parents[r]:this.get_text(e.parents[r]))}s=s.reverse().slice(1);return t?s.join(t):s},get_next_dom:function(t,n){var r;t=this.get_node(t,true);if(t[0]===this.element[0]){r=this._firstChild(this.get_container_ul()[0]);return r?e(r):false}if(!t||!t.length){return false}if(n){r=this._nextSibling(t[0]);return r?e(r):false}if(t.hasClass("jstree-open")){r=this._firstChild(t.children(".jstree-children")[0]);return r?e(r):false}if((r=this._nextSibling(t[0]))!==null){return e(r)}return t.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0)},get_prev_dom:function(t,n){var r;t=this.get_node(t,true);if(t[0]===this.element[0]){r=this.get_container_ul()[0].lastChild;return r?e(r):false}if(!t||!t.length){return false}if(n){r=this._previousSibling(t[0]);return r?e(r):false}if((r=this._previousSibling(t[0]))!==null){t=e(r);while(t.hasClass("jstree-open")){t=t.children(".jstree-children:eq(0)").children(".jstree-node:last")}return t}r=t[0].parentNode.parentNode;return r&&r.className&&r.className.indexOf("jstree-node")!==-1?e(r):false},get_parent:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}return e.parent},get_children_dom:function(e){e=this.get_node(e,true);if(e[0]===this.element[0]){return this.get_container_ul().children(".jstree-node")}if(!e||!e.length){return false}return e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){e=this.get_node(e);return e&&(e.state.loaded===false||e.children.length>0)},is_loaded:function(e){e=this.get_node(e);return e&&e.state.loaded},is_loading:function(e){e=this.get_node(e);return e&&e.state&&e.state.loading},is_open:function(e){e=this.get_node(e);return e&&e.state.opened},is_closed:function(e){e=this.get_node(e);return e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,n){var r,i,s,o,u;if(e.isArray(t)){this._load_nodes(t.slice(),n);return true}t=this.get_node(t);if(!t){if(n){n.call(this,t,false)}return false}if(t.state.loaded){t.state.loaded=false;for(r=0,i=t.children_d.length;r<i;r++){for(s=0,o=t.parents.length;s<o;s++){this._model.data[t.parents[s]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[s]].children_d,t.children_d[r])}if(this._model.data[t.children_d[r]].state.selected){u=true;this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[r])}delete this._model.data[t.children_d[r]]}t.children=[];t.children_d=[];if(u){this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}}t.state.loading=true;this.get_node(t,true).addClass("jstree-loading");this._load_node(t,e.proxy(function(e){t=this._model.data[t.id];t.state.loading=false;t.state.loaded=e;var r=this.get_node(t,true);if(t.state.loaded&&!t.children.length&&r&&r.length&&!r.hasClass("jstree-leaf")){r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf")}r.removeClass("jstree-loading");this.trigger("load_node",{node:t,status:e});if(n){n.call(this,t,e)}},this));return true},_load_nodes:function(e,t,n){var r=true,i=function(){this._load_nodes(e,t,true)},s=this._model.data,o,u;for(o=0,u=e.length;o<u;o++){if(s[e[o]]&&(!s[e[o]].state.loaded||!n)){if(!this.is_loading(e[o])){this.load_node(e[o],i)}r=false}}if(r){if(t&&!t.done){t.call(this,e);t.done=true}}},_load_node:function(t,n){var r=this.settings.core.data,i;if(!r){if(t.id==="#"){return this._append_html_data(t,this._data.core.original_container_html.clone(true),function(e){n.call(this,e)})}else{return n.call(this,false)}}if(e.isFunction(r)){return r.call(this,t,e.proxy(function(r){if(r===false){n.call(this,false)}this[typeof r==="string"?"_append_html_data":"_append_json_data"](t,typeof r==="string"?e(r):r,function(e){n.call(this,e)})},this))}if(typeof r==="object"){if(r.url){r=e.extend(true,{},r);if(e.isFunction(r.url)){r.url=r.url.call(this,t)}if(e.isFunction(r.data)){r.data=r.data.call(this,t)}return e.ajax(r).done(e.proxy(function(r,i,s){var o=s.getResponseHeader("Content-Type");if(o.indexOf("json")!==-1||typeof r==="object"){return this._append_json_data(t,r,function(e){n.call(this,e)})}if(o.indexOf("html")!==-1||typeof r==="string"){return this._append_html_data(t,e(r),function(e){n.call(this,e)})}this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:s})};this.settings.core.error.call(this,this._data.core.last_error);return n.call(this,false)},this)).fail(e.proxy(function(e){n.call(this,false);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})};this.settings.core.error.call(this,this._data.core.last_error)},this))}i=e.isArray(r)||e.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r;if(t.id==="#"){return this._append_json_data(t,i,function(e){n.call(this,e)})}else{this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})};this.settings.core.error.call(this,this._data.core.last_error);return n.call(this,false)}}if(typeof r==="string"){if(t.id==="#"){return this._append_html_data(t,e(r),function(e){n.call(this,e)})}else{this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})};this.settings.core.error.call(this,this._data.core.last_error);return n.call(this,false)}}return n.call(this,false)},_node_changed:function(e){e=this.get_node(e);if(e){this._model.changed.push(e.id)}},_append_html_data:function(t,n,r){t=this.get_node(t);t.children=[];t.children_d=[];var i=n.is("ul")?n.children():n,s=t.id,o=[],u=[],a=this._model.data,f=a[s],l=this._data.core.selected.length,c,h,p;i.each(e.proxy(function(t,n){c=this._parse_model_from_html(e(n),s,f.parents.concat());if(c){o.push(c);u.push(c);if(a[c].children_d.length){u=u.concat(a[c].children_d)}}},this));f.children=o;f.children_d=u;for(h=0,p=f.parents.length;h<p;h++){a[f.parents[h]].children_d=a[f.parents[h]].children_d.concat(u)}this.trigger("model",{nodes:u,parent:s});if(s!=="#"){this._node_changed(s);this.redraw()}else{this.get_container_ul().children(".jstree-initial-node").remove();this.redraw(true)}if(this._data.core.selected.length!==l){this.trigger("changed",{action:"model",selected:this._data.core.selected})}r.call(this,true)},_append_json_data:function(t,n,r){t=this.get_node(t);t.children=[];t.children_d=[];if(n.d){n=n.d;if(typeof n==="string"){n=JSON.parse(n)}}if(!e.isArray(n)){n=[n]}var i=null,s={df:this._model.default_state,dat:n,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){if(e.data){e=e.data}var n=e.dat,r=e.par,i=[],s=[],o=[],u=e.df,a=e.t_id,f=e.t_cnt,l=e.m,c=l[r],h=e.sel,p,d,v,m,g=function(e,n,r){if(!r){r=[]}else{r=r.concat()}if(n){r.unshift(n)}var i=e.id.toString(),s,a,f,c,h={id:i,text:e.text||"",icon:e.icon!==t?e.icon:true,parent:n,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(s in u){if(u.hasOwnProperty(s)){h.state[s]=u[s]}}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){h.icon=e.data.jstree.icon}if(e&&e.data){h.data=e.data;if(e.data.jstree){for(s in e.data.jstree){if(e.data.jstree.hasOwnProperty(s)){h.state[s]=e.data.jstree[s]}}}}if(e&&typeof e.state==="object"){for(s in e.state){if(e.state.hasOwnProperty(s)){h.state[s]=e.state[s]}}}if(e&&typeof e.li_attr==="object"){for(s in e.li_attr){if(e.li_attr.hasOwnProperty(s)){h.li_attr[s]=e.li_attr[s]}}}if(!h.li_attr.id){h.li_attr.id=i}if(e&&typeof e.a_attr==="object"){for(s in e.a_attr){if(e.a_attr.hasOwnProperty(s)){h.a_attr[s]=e.a_attr[s]}}}if(e&&e.children&&e.children===true){h.state.loaded=false;h.children=[];h.children_d=[]}l[h.id]=h;for(s=0,a=h.children.length;s<a;s++){f=g(l[h.children[s]],h.id,r);c=l[f];h.children_d.push(f);if(c.children_d.length){h.children_d=h.children_d.concat(c.children_d)}}delete e.data;delete e.children;l[h.id].original=e;if(h.state.selected){o.push(h.id)}return h.id},y=function(e,n,r){if(!r){r=[]}else{r=r.concat()}if(n){r.unshift(n)}var i=false,s,c,h,p,d;do{i="j"+a+"_"+ ++f}while(l[i]);d={id:false,text:typeof e==="string"?e:"",icon:typeof e==="object"&&e.icon!==t?e.icon:true,parent:n,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(s in u){if(u.hasOwnProperty(s)){d.state[s]=u[s]}}if(e&&e.id){d.id=e.id.toString()}if(e&&e.text){d.text=e.text}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){d.icon=e.data.jstree.icon}if(e&&e.data){d.data=e.data;if(e.data.jstree){for(s in e.data.jstree){if(e.data.jstree.hasOwnProperty(s)){d.state[s]=e.data.jstree[s]}}}}if(e&&typeof e.state==="object"){for(s in e.state){if(e.state.hasOwnProperty(s)){d.state[s]=e.state[s]}}}if(e&&typeof e.li_attr==="object"){for(s in e.li_attr){if(e.li_attr.hasOwnProperty(s)){d.li_attr[s]=e.li_attr[s]}}}if(d.li_attr.id&&!d.id){d.id=d.li_attr.id.toString()}if(!d.id){d.id=i}if(!d.li_attr.id){d.li_attr.id=d.id}if(e&&typeof e.a_attr==="object"){for(s in e.a_attr){if(e.a_attr.hasOwnProperty(s)){d.a_attr[s]=e.a_attr[s]}}}if(e&&e.children&&e.children.length){for(s=0,c=e.children.length;s<c;s++){h=y(e.children[s],d.id,r);p=l[h];d.children.push(h);if(p.children_d.length){d.children_d=d.children_d.concat(p.children_d)}}d.children_d=d.children_d.concat(d.children)}if(e&&e.children&&e.children===true){d.state.loaded=false;d.children=[];d.children_d=[]}delete e.data;delete e.children;d.original=e;l[d.id]=d;if(d.state.selected){o.push(d.id)}return d.id};if(n.length&&n[0].id!==t&&n[0].parent!==t){for(d=0,v=n.length;d<v;d++){if(!n[d].children){n[d].children=[]}l[n[d].id.toString()]=n[d]}for(d=0,v=n.length;d<v;d++){l[n[d].parent.toString()].children.push(n[d].id.toString());c.children_d.push(n[d].id.toString())}for(d=0,v=c.children.length;d<v;d++){p=g(l[c.children[d]],r,c.parents.concat());s.push(p);if(l[p].children_d.length){s=s.concat(l[p].children_d)}}for(d=0,v=c.parents.length;d<v;d++){l[c.parents[d]].children_d=l[c.parents[d]].children_d.concat(s)}m={cnt:f,mod:l,sel:h,par:r,dpc:s,add:o}}else{for(d=0,v=n.length;d<v;d++){p=y(n[d],r,c.parents.concat());if(p){i.push(p);s.push(p);if(l[p].children_d.length){s=s.concat(l[p].children_d)}}}c.children=i;c.children_d=s;for(d=0,v=c.parents.length;d<v;d++){l[c.parents[d]].children_d=l[c.parents[d]].children_d.concat(s)}m={cnt:f,mod:l,sel:h,par:r,dpc:s,add:o}}return m},u=function(t,n){this._cnt=t.cnt;this._model.data=t.mod;if(n){var i,s,o=t.add,u=t.sel,a=this._data.core.selected.slice(),f=this._model.data;if(u.length!==a.length||e.vakata.array_unique(u.concat(a)).length!==u.length){for(i=0,s=u.length;i<s;i++){if(e.inArray(u[i],o)===-1&&e.inArray(u[i],a)===-1){f[u[i]].state.selected=false}}for(i=0,s=a.length;i<s;i++){if(e.inArray(a[i],u)===-1){f[a[i]].state.selected=true}}}}if(t.add.length){this._data.core.selected=this._data.core.selected.concat(t.add)}this.trigger("model",{nodes:t.dpc,parent:t.par});if(t.par!=="#"){this._node_changed(t.par);this.redraw()}else{this.redraw(true)}if(t.add.length){this.trigger("changed",{action:"model",selected:this._data.core.selected})}r.call(this,true)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker){try{if(this._wrk===null){this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))}i=new window.Worker(this._wrk);i.onmessage=e.proxy(function(e){u.call(this,e.data,true);this._data.core.working=false;if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}},this);if(!this._data.core.working){this._data.core.working=true;i.postMessage(s)}else{this._data.core.worker_queue.push([t,n,r])}}catch(a){u.call(this,o(s),false)}}else{u.call(this,o(s),false)}},_parse_model_from_html:function(t,n,r){if(!r){r=[]}else{r=[].concat(r)}if(n){r.unshift(n)}var i,s,o=this._model.data,u={id:false,text:false,icon:true,parent:n,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false},a,f,l;for(a in this._model.default_state){if(this._model.default_state.hasOwnProperty(a)){u.state[a]=this._model.default_state[a]}}f=e.vakata.attributes(t,true);e.each(f,function(t,n){n=e.trim(n);if(!n.length){return true}u.li_attr[t]=n;if(t==="id"){u.id=n.toString()}});f=t.children("a").eq(0);if(f.length){f=e.vakata.attributes(f,true);e.each(f,function(t,n){n=e.trim(n);if(n.length){u.a_attr[t]=n}})}f=t.children("a:eq(0)").length?t.children("a:eq(0)").clone():t.clone();f.children("ins, i, ul").remove();f=f.html();f=e("<div />").html(f);u.text=this.settings.core.force_text?f.text():f.html();f=t.data();u.data=f?e.extend(true,{},f):null;u.state.opened=t.hasClass("jstree-open");u.state.selected=t.children("a").hasClass("jstree-clicked");u.state.disabled=t.children("a").hasClass("jstree-disabled");if(u.data&&u.data.jstree){for(a in u.data.jstree){if(u.data.jstree.hasOwnProperty(a)){u.state[a]=u.data.jstree[a]}}}f=t.children("a").children(".jstree-themeicon");if(f.length){u.icon=f.hasClass("jstree-themeicon-hidden")?false:f.attr("rel")}if(u.state.icon){u.icon=u.state.icon}f=t.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(o[l]);u.id=u.li_attr.id?u.li_attr.id.toString():l;if(f.length){f.each(e.proxy(function(t,n){i=this._parse_model_from_html(e(n),u.id,r);s=this._model.data[i];u.children.push(i);if(s.children_d.length){u.children_d=u.children_d.concat(s.children_d)}},this));u.children_d=u.children_d.concat(u.children)}else{if(t.hasClass("jstree-closed")){u.state.loaded=false}}if(u.li_attr["class"]){u.li_attr["class"]=u.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")}if(u.a_attr["class"]){u.a_attr["class"]=u.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")}o[u.id]=u;if(u.state.selected){this._data.core.selected.push(u.id)}return u.id},_parse_model_from_flat_json:function(e,n,r){if(!r){r=[]}else{r=r.concat()}if(n){r.unshift(n)}var i=e.id.toString(),s=this._model.data,o=this._model.default_state,u,a,f,l,c={id:i,text:e.text||"",icon:e.icon!==t?e.icon:true,parent:n,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(u in o){if(o.hasOwnProperty(u)){c.state[u]=o[u]}}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){c.icon=e.data.jstree.icon}if(e&&e.data){c.data=e.data;if(e.data.jstree){for(u in e.data.jstree){if(e.data.jstree.hasOwnProperty(u)){c.state[u]=e.data.jstree[u]}}}}if(e&&typeof e.state==="object"){for(u in e.state){if(e.state.hasOwnProperty(u)){c.state[u]=e.state[u]}}}if(e&&typeof e.li_attr==="object"){for(u in e.li_attr){if(e.li_attr.hasOwnProperty(u)){c.li_attr[u]=e.li_attr[u]}}}if(!c.li_attr.id){c.li_attr.id=i}if(e&&typeof e.a_attr==="object"){for(u in e.a_attr){if(e.a_attr.hasOwnProperty(u)){c.a_attr[u]=e.a_attr[u]}}}if(e&&e.children&&e.children===true){c.state.loaded=false;c.children=[];c.children_d=[]}s[c.id]=c;for(u=0,a=c.children.length;u<a;u++){f=this._parse_model_from_flat_json(s[c.children[u]],c.id,r);l=s[f];c.children_d.push(f);if(l.children_d.length){c.children_d=c.children_d.concat(l.children_d)}}delete e.data;delete e.children;s[c.id].original=e;if(c.state.selected){this._data.core.selected.push(c.id)}return c.id},_parse_model_from_json:function(e,n,r){if(!r){r=[]}else{r=r.concat()}if(n){r.unshift(n)}var i=false,s,o,u,a,f=this._model.data,l=this._model.default_state,c;do{i="j"+this._id+"_"+ ++this._cnt}while(f[i]);c={id:false,text:typeof e==="string"?e:"",icon:typeof e==="object"&&e.icon!==t?e.icon:true,parent:n,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(s in l){if(l.hasOwnProperty(s)){c.state[s]=l[s]}}if(e&&e.id){c.id=e.id.toString()}if(e&&e.text){c.text=e.text}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){c.icon=e.data.jstree.icon}if(e&&e.data){c.data=e.data;if(e.data.jstree){for(s in e.data.jstree){if(e.data.jstree.hasOwnProperty(s)){c.state[s]=e.data.jstree[s]}}}}if(e&&typeof e.state==="object"){for(s in e.state){if(e.state.hasOwnProperty(s)){c.state[s]=e.state[s]}}}if(e&&typeof e.li_attr==="object"){for(s in e.li_attr){if(e.li_attr.hasOwnProperty(s)){c.li_attr[s]=e.li_attr[s]}}}if(c.li_attr.id&&!c.id){c.id=c.li_attr.id.toString()}if(!c.id){c.id=i}if(!c.li_attr.id){c.li_attr.id=c.id}if(e&&typeof e.a_attr==="object"){for(s in e.a_attr){if(e.a_attr.hasOwnProperty(s)){c.a_attr[s]=e.a_attr[s]}}}if(e&&e.children&&e.children.length){for(s=0,o=e.children.length;s<o;s++){u=this._parse_model_from_json(e.children[s],c.id,r);a=f[u];c.children.push(u);if(a.children_d.length){c.children_d=c.children_d.concat(a.children_d)}}c.children_d=c.children_d.concat(c.children)}if(e&&e.children&&e.children===true){c.state.loaded=false;c.children=[];c.children_d=[]}delete e.data;delete e.children;c.original=e;f[c.id]=c;if(c.state.selected){this._data.core.selected.push(c.id)}return c.id},_redraw:function(){var e=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),t=document.createElement("UL"),n,r,i;for(r=0,i=e.length;r<i;r++){n=this.redraw_node(e[r],true,this._model.force_full_redraw);if(n&&this._model.force_full_redraw){t.appendChild(n)}}if(this._model.force_full_redraw){t.className=this.get_container_ul()[0].className;this.element.empty().append(t)}this._model.force_full_redraw=false;this._model.changed=[];this.trigger("redraw",{nodes:e})},redraw:function(e){if(e){this._model.force_full_redraw=true}this._redraw()},redraw_node:function(t,n,r){var i=this.get_node(t),s=false,o=false,u=false,a=false,l=false,c=false,h="",p=document,d=this._model.data,v=false,m=false,g=null;if(!i){return false}if(i.id==="#"){return this.redraw(true)}n=n||i.children.length===0;t=!document.querySelector?document.getElementById(i.id):this.element[0].querySelector("#"+("0123456789".indexOf(i.id[0])!==-1?"\\3"+i.id[0]+" "+i.id.substr(1).replace(e.jstree.idregex,"\\$&"):i.id.replace(e.jstree.idregex,"\\$&")));if(!t){n=true;if(!r){s=i.parent!=="#"?e("#"+i.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null;if(s!==null&&(!s||!d[i.parent].state.opened)){return false}o=e.inArray(i.id,s===null?d["#"].children:d[i.parent].children)}}else{t=e(t);if(!r){s=t.parent().parent()[0];if(s===this.element[0]){s=null}o=t.index()}if(!n&&i.children.length&&!t.children(".jstree-children").length){n=true}if(!n){u=t.children(".jstree-children")[0]}m=t.attr("aria-selected");v=t.children(".jstree-anchor")[0]===document.activeElement;t.remove()}t=f.cloneNode(true);h="jstree-node ";for(a in i.li_attr){if(i.li_attr.hasOwnProperty(a)){if(a==="id"){continue}if(a!=="class"){t.setAttribute(a,i.li_attr[a])}else{h+=i.li_attr[a]}}}if(m&&m!=="false"){t.setAttribute("aria-selected",true)}if(i.state.loaded&&!i.children.length){h+=" jstree-leaf"}else{h+=i.state.opened&&i.state.loaded?" jstree-open":" jstree-closed";t.setAttribute("aria-expanded",i.state.opened&&i.state.loaded)}if(i.parent!==null&&d[i.parent].children[d[i.parent].children.length-1]===i.id){h+=" jstree-last"}t.id=i.id;t.className=h;h=(i.state.selected?" jstree-clicked":"")+(i.state.disabled?" jstree-disabled":"");for(l in i.a_attr){if(i.a_attr.hasOwnProperty(l)){if(l==="href"&&i.a_attr[l]==="#"){continue}if(l!=="class"){t.childNodes[1].setAttribute(l,i.a_attr[l])}else{h+=" "+i.a_attr[l]}}}if(h.length){t.childNodes[1].className="jstree-anchor "+h}if(i.icon&&i.icon!==true||i.icon===false){if(i.icon===false){t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden"}else if(i.icon.indexOf("/")===-1&&i.icon.indexOf(".")===-1){t.childNodes[1].childNodes[0].className+=" "+i.icon+" jstree-themeicon-custom"}else{t.childNodes[1].childNodes[0].style.backgroundImage="url("+i.icon+")";t.childNodes[1].childNodes[0].style.backgroundPosition="center center";t.childNodes[1].childNodes[0].style.backgroundSize="auto";t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom"}}if(this.settings.core.force_text){t.childNodes[1].appendChild(p.createTextNode(i.text))}else{t.childNodes[1].innerHTML+=i.text}if(n&&i.children.length&&i.state.opened&&i.state.loaded){c=p.createElement("UL");c.setAttribute("role","group");c.className="jstree-children";for(a=0,l=i.children.length;a<l;a++){c.appendChild(this.redraw_node(i.children[a],n,true))}t.appendChild(c)}if(u){t.appendChild(u)}if(!r){if(!s){s=this.element[0]}for(a=0,l=s.childNodes.length;a<l;a++){if(s.childNodes[a]&&s.childNodes[a].className&&s.childNodes[a].className.indexOf("jstree-children")!==-1){g=s.childNodes[a];break}}if(!g){g=p.createElement("UL");g.setAttribute("role","group");g.className="jstree-children";s.appendChild(g)}s=g;if(o<s.childNodes.length){s.insertBefore(t,s.childNodes[o])}else{s.appendChild(t)}if(v){t.childNodes[1].focus()}}if(i.state.opened&&!i.state.loaded){i.state.opened=false;setTimeout(e.proxy(function(){this.open_node(i.id,false,0)},this),0)}return t},open_node:function(n,r,i){var s,o,u,a;if(e.isArray(n)){n=n.slice();for(s=0,o=n.length;s<o;s++){this.open_node(n[s],r,i)}return true}n=this.get_node(n);if(!n||n.id==="#"){return false}i=i===t?this.settings.core.animation:i;if(!this.is_closed(n)){if(r){r.call(this,n,false)}return false}if(!this.is_loaded(n)){if(this.is_loading(n)){return setTimeout(e.proxy(function(){this.open_node(n,r,i)},this),500)}this.load_node(n,function(e,t){return t?this.open_node(e,r,i):r?r.call(this,e,false):false})}else{u=this.get_node(n,true);a=this;if(u.length){if(n.children.length&&!this._firstChild(u.children(".jstree-children")[0])){n.state.opened=true;this.redraw_node(n,true);u=this.get_node(n,true)}if(!i){this.trigger("before_open",{node:n});u[0].className=u[0].className.replace("jstree-closed","jstree-open");u[0].setAttribute("aria-expanded",true)}else{this.trigger("before_open",{node:n});u.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",true).children(".jstree-children").stop(true,true).slideDown(i,function(){this.style.display="";a.trigger("after_open",{node:n})})}}n.state.opened=true;if(r){r.call(this,n,true)}if(!u.length){this.trigger("before_open",{node:n})}this.trigger("open_node",{node:n});if(!i||!u.length){this.trigger("after_open",{node:n})}}},_open_to:function(t){t=this.get_node(t);if(!t||t.id==="#"){return false}var n,r,i=t.parents;for(n=0,r=i.length;n<r;n+=1){if(n!=="#"){this.open_node(i[n],false,0)}}return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(n,r){var i,s,o,u;if(e.isArray(n)){n=n.slice();for(i=0,s=n.length;i<s;i++){this.close_node(n[i],r)}return true}n=this.get_node(n);if(!n||n.id==="#"){return false}if(this.is_closed(n)){return false}r=r===t?this.settings.core.animation:r;o=this;u=this.get_node(n,true);if(u.length){if(!r){u[0].className=u[0].className.replace("jstree-open","jstree-closed");u.attr("aria-expanded",false).children(".jstree-children").remove()}else{u.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",false).children(".jstree-children").stop(true,true).slideUp(r,function(){this.style.display="";u.children(".jstree-children").remove();o.trigger("after_close",{node:n})})}}n.state.opened=false;this.trigger("close_node",{node:n});if(!r||!u.length){this.trigger("after_close",{node:n})}},toggle_node:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++){this.toggle_node(t[n])}return true}if(this.is_closed(t)){return this.open_node(t)}if(this.is_open(t)){return this.close_node(t)}},open_all:function(e,t,n){if(!e){e="#"}e=this.get_node(e);if(!e){return false}var r=e.id==="#"?this.get_container_ul():this.get_node(e,true),i,s,o;if(!r.length){for(i=0,s=e.children_d.length;i<s;i++){if(this.is_closed(this._model.data[e.children_d[i]])){this._model.data[e.children_d[i]].state.opened=true}}return this.trigger("open_all",{node:e})}n=n||r;o=this;r=this.is_closed(e)?r.find(".jstree-closed").addBack():r.find(".jstree-closed");r.each(function(){o.open_node(this,function(e,r){if(r&&this.is_parent(e)){this.open_all(e,t,n)}},t||0)});if(n.find(".jstree-closed").length===0){this.trigger("open_all",{node:this.get_node(n)})}},close_all:function(t,n){if(!t){t="#"}t=this.get_node(t);if(!t){return false}var r=t.id==="#"?this.get_container_ul():this.get_node(t,true),i=this,s,o;if(!r.length){for(s=0,o=t.children_d.length;s<o;s++){this._model.data[t.children_d[s]].state.opened=false}return this.trigger("close_all",{node:t})}r=this.is_open(t)?r.find(".jstree-open").addBack():r.find(".jstree-open");e(r.get().reverse()).each(function(){i.close_node(this,n||0)});this.trigger("close_all",{node:t})},is_disabled:function(e){e=this.get_node(e);return e&&e.state&&e.state.disabled},enable_node:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++){this.enable_node(t[n])}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}t.state.disabled=false;this.get_node(t,true).children(".jstree-anchor").removeClass("jstree-disabled");this.trigger("enable_node",{node:t})},disable_node:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++){this.disable_node(t[n])}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}t.state.disabled=true;this.get_node(t,true).children(".jstree-anchor").addClass("jstree-disabled");this.trigger("disable_node",{node:t})},activate_node:function(e,n){if(this.is_disabled(e)){return false}this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null;if(this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected){this._data.core.last_clicked=null}if(!this._data.core.last_clicked&&this._data.core.selected.length){this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])}if(!this.settings.core.multiple||!n.metaKey&&!n.ctrlKey&&!n.shiftKey||n.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(e)||this.get_parent(e)!==this._data.core.last_clicked.parent)){if(!this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&this.is_selected(e)){this.deselect_node(e,false,n)}else{this.deselect_all(true);this.select_node(e,false,false,n);this._data.core.last_clicked=this.get_node(e)}}else{if(n.shiftKey){var r=this.get_node(e).id,i=this._data.core.last_clicked.id,s=this.get_node(this._data.core.last_clicked.parent).children,o=false,u,a;for(u=0,a=s.length;u<a;u+=1){if(s[u]===r){o=!o}if(s[u]===i){o=!o}if(o||s[u]===r||s[u]===i){this.select_node(s[u],false,false,n)}else{this.deselect_node(s[u],false,n)}}}else{if(!this.is_selected(e)){this.select_node(e,false,false,n)}else{this.deselect_node(e,false,n)}}}this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){e=this.get_node(e,true);if(!e||!e.length||e.children(".jstree-hovered").length){return false}var t=this.element.find(".jstree-hovered"),n=this.element;if(t&&t.length){this.dehover_node(t)}e.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(e)});setTimeout(function(){n.attr("aria-activedescendant",e[0].id);e.attr("aria-selected",true)},0)},dehover_node:function(e){e=this.get_node(e,true);if(!e||!e.length||!e.children(".jstree-hovered").length){return false}e.attr("aria-selected",false).children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,n,r,i){var s,o,u,a;if(e.isArray(t)){t=t.slice();for(o=0,u=t.length;o<u;o++){this.select_node(t[o],n,r,i)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}s=this.get_node(t,true);if(!t.state.selected){t.state.selected=true;this._data.core.selected.push(t.id);if(!r){s=this._open_to(t)}if(s&&s.length){s.children(".jstree-anchor").addClass("jstree-clicked")}this.trigger("select_node",{node:t,selected:this._data.core.selected,event:i});if(!n){this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:i})}}},deselect_node:function(t,n,r){var i,s,o;if(e.isArray(t)){t=t.slice();for(i=0,s=t.length;i<s;i++){this.deselect_node(t[i],n,r)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}o=this.get_node(t,true);if(t.state.selected){t.state.selected=false;this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id);if(o.length){o.children(".jstree-anchor").removeClass("jstree-clicked")}this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r});if(!n){this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r})}}},select_all:function(e){var t=this._data.core.selected.concat([]),n,r;this._data.core.selected=this._model.data["#"].children_d.concat();for(n=0,r=this._data.core.selected.length;n<r;n++){if(this._model.data[this._data.core.selected[n]]){this._model.data[this._data.core.selected[n]].state.selected=true}}this.redraw(true);this.trigger("select_all",{selected:this._data.core.selected});if(!e){this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:t})}},deselect_all:function(e){var t=this._data.core.selected.concat([]),n,r;for(n=0,r=this._data.core.selected.length;n<r;n++){if(this._model.data[this._data.core.selected[n]]){this._model.data[this._data.core.selected[n]].state.selected=false}}this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked");this.trigger("deselect_all",{selected:this._data.core.selected,node:t});if(!e){this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})}},is_selected:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}return e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected},get_top_selected:function(t){var n=this.get_selected(true),r={},i,s,o,u;for(i=0,s=n.length;i<s;i++){r[n[i].id]=n[i]}for(i=0,s=n.length;i<s;i++){for(o=0,u=n[i].children_d.length;o<u;o++){if(r[n[i].children_d[o]]){delete r[n[i].children_d[o]]}}}n=[];for(i in r){if(r.hasOwnProperty(i)){n.push(i)}}return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_bottom_selected:function(t){var n=this.get_selected(true),r=[],i,s;for(i=0,s=n.length;i<s;i++){if(!n[i].children.length){r.push(n[i].id)}}return t?e.map(r,e.proxy(function(e){return this.get_node(e)},this)):r},get_state:function(){var e={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},t;for(t in this._model.data){if(this._model.data.hasOwnProperty(t)){if(t!=="#"){if(this._model.data[t].state.opened){e.core.open.push(t)}if(this._model.data[t].state.selected){e.core.selected.push(t)}}}}return e},set_state:function(n,r){if(n){if(n.core){var i,s,o,u;if(n.core.open){if(!e.isArray(n.core.open)){delete n.core.open;this.set_state(n,r);return false}i=true;s=false;o=this;e.each(n.core.open.concat([]),function(t,u){s=o.get_node(u);if(s){if(o.is_loaded(u)){if(o.is_closed(u)){o.open_node(u,false,0)}if(n&&n.core&&n.core.open){e.vakata.array_remove_item(n.core.open,u)}}else{if(!o.is_loading(u)){o.open_node(u,e.proxy(function(t,i){if(!i&&n&&n.core&&n.core.open){e.vakata.array_remove_item(n.core.open,t.id)}this.set_state(n,r)},o),0)}i=false}}});if(i){delete n.core.open;this.set_state(n,r)}return false}if(n.core.scroll){if(n.core.scroll&&n.core.scroll.left!==t){this.element.scrollLeft(n.core.scroll.left)}if(n.core.scroll&&n.core.scroll.top!==t){this.element.scrollTop(n.core.scroll.top)}delete n.core.scroll;this.set_state(n,r);return false}if(n.core.selected){u=this;this.deselect_all();e.each(n.core.selected,function(e,t){u.select_node(t)});delete n.core.selected;this.set_state(n,r);return false}if(e.isEmptyObject(n.core)){delete n.core;this.set_state(n,r);return false}}if(e.isEmptyObject(n)){n=null;if(r){r.call(this)}this.trigger("set_state");return false}return true}return false},refresh:function(t,n){this._data.core.state=null;if(!n){this._data.core.state=this.get_state()}this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}};var r=this.get_container_ul()[0].className;if(!t){this.element.html("<"+"ul class='"+r+"'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>")}this.load_node("#",function(t,n){if(n){this.get_container_ul()[0].className=r;this.set_state(e.extend(true,{},this._data.core.state),function(){this.trigger("refresh")})}this._data.core.state=null})},refresh_node:function(t){t=this.get_node(t);if(!t||t.id==="#"){return false}var n=[],r=[],i=this._data.core.selected.concat([]);r.push(t.id);if(t.state.opened===true){n.push(t.id)}this.get_node(t,true).find(".jstree-open").each(function(){n.push(this.id)});this._load_nodes(r,e.proxy(function(e){this.open_node(n,false,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,n){t=this.get_node(t);if(!t||t.id==="#"){return false}var r,i,s=this._model.data;n=n.toString();s[t.parent].children[e.inArray(t.id,s[t.parent].children)]=n;for(r=0,i=t.parents.length;r<i;r++){s[t.parents[r]].children_d[e.inArray(t.id,s[t.parents[r]].children_d)]=n}for(r=0,i=t.children.length;r<i;r++){s[t.children[r]].parent=n}for(r=0,i=t.children_d.length;r<i;r++){s[t.children_d[r]].parents[e.inArray(t.id,s[t.children_d[r]].parents)]=n}r=e.inArray(t.id,this._data.core.selected);if(r!==-1){this._data.core.selected[r]=n}r=this.get_node(t.id,true);if(r){r.attr("id",n)}delete s[t.id];t.id=n;s[n]=t;return true},get_text:function(e){e=this.get_node(e);return!e||e.id==="#"?false:e.text},set_text:function(t,n){var r,i;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++){this.set_text(t[r],n)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}t.text=n;if(this.get_node(t,true).length){this.redraw_node(t.id)}this.trigger("set_text",{obj:t,text:n});return true},get_json:function(e,t,n){e=this.get_node(e||"#");if(!e){return false}if(t&&t.flat&&!n){n=[]}var r={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:e.li_attr,a_attr:e.a_attr,state:{},data:t&&t.no_data?false:e.data},i,s;if(t&&t.flat){r.parent=e.parent}else{r.children=[]}if(!t||!t.no_state){for(i in e.state){if(e.state.hasOwnProperty(i)){r.state[i]=e.state[i]}}}if(t&&t.no_id){delete r.id;if(r.li_attr&&r.li_attr.id){delete r.li_attr.id}}if(t&&t.flat&&e.id!=="#"){n.push(r)}if(!t||!t.no_children){for(i=0,s=e.children.length;i<s;i++){if(t&&t.flat){this.get_json(e.children[i],t,n)}else{r.children.push(this.get_json(e.children[i],t))}}}return t&&t.flat?n:e.id==="#"?r.children:r},create_node:function(n,r,i,s,o){if(n===null){n="#"}n=this.get_node(n);if(!n){return false}i=i===t?"last":i;if(!i.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n)){return this.load_node(n,function(){this.create_node(n,r,i,s,true)})}if(!r){r={text:this.get_string("New node")}}if(r.text===t){r.text=this.get_string("New node")}var u,a,f,l;if(n.id==="#"){if(i==="before"){i="first"}if(i==="after"){i="last"}}switch(i){case"before":u=this.get_node(n.parent);i=e.inArray(n.id,u.children);n=u;break;case"after":u=this.get_node(n.parent);i=e.inArray(n.id,u.children)+1;n=u;break;case"inside":case"first":i=0;break;case"last":i=n.children.length;break;default:if(!i){i=0}break}if(i>n.children.length){i=n.children.length}if(!r.id){r.id=true}if(!this.check("create_node",r,n,i)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(r.id===true){delete r.id}r=this._parse_model_from_json(r,n.id,n.parents.concat());if(!r){return false}u=this.get_node(r);a=[];a.push(r);a=a.concat(u.children_d);this.trigger("model",{nodes:a,parent:n.id});n.children_d=n.children_d.concat(a);for(f=0,l=n.parents.length;f<l;f++){this._model.data[n.parents[f]].children_d=this._model.data[n.parents[f]].children_d.concat(a)}r=u;u=[];for(f=0,l=n.children.length;f<l;f++){u[f>=i?f+1:f]=n.children[f]}u[i]=r.id;n.children=u;this.redraw_node(n,true);if(s){s.call(this,this.get_node(r))}this.trigger("create_node",{node:this.get_node(r),parent:n.id,position:i});return r.id},rename_node:function(t,n){var r,i,s;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++){this.rename_node(t[r],n)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}s=t.text;if(!this.check("rename_node",t,this.get_parent(t),n)){this.settings.core.error.call(this,this._data.core.last_error);return false}this.set_text(t,n);this.trigger("rename_node",{node:t,text:n,old:s});return true},delete_node:function(t){var n,r,i,s,o,u,a,f,l,c;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++){this.delete_node(t[n])}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}i=this.get_node(t.parent);s=e.inArray(t.id,i.children);c=false;if(!this.check("delete_node",t,i,s)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(s!==-1){i.children=e.vakata.array_remove(i.children,s)}o=t.children_d.concat([]);o.push(t.id);for(f=0,l=o.length;f<l;f++){for(u=0,a=t.parents.length;u<a;u++){s=e.inArray(o[f],this._model.data[t.parents[u]].children_d);if(s!==-1){this._model.data[t.parents[u]].children_d=e.vakata.array_remove(this._model.data[t.parents[u]].children_d,s)}}if(this._model.data[o[f]].state.selected){c=true;s=e.inArray(o[f],this._data.core.selected);if(s!==-1){this._data.core.selected=e.vakata.array_remove(this._data.core.selected,s)}}}this.trigger("delete_node",{node:t,parent:i.id});if(c){this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:i.id})}for(f=0,l=o.length;f<l;f++){delete this._model.data[o[f]]}this.redraw_node(i,true);return true},check:function(t,n,r,i,s){n=n&&n.id?n:this.get_node(n);r=r&&r.id?r:this.get_node(r);var o=t.match(/^move_node|copy_node|create_node$/i)?r:n,u=this.settings.core.check_callback;if(t==="move_node"||t==="copy_node"){if((!s||!s.is_multi)&&(n.id===r.id||e.inArray(n.id,r.children)===i||e.inArray(r.id,n.children_d)!==-1)){this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:i,obj:n&&n.id?n.id:false,par:r&&r.id?r.id:false})};return false}}if(o&&o.data){o=o.data}if(o&&o.functions&&(o.functions[t]===false||o.functions[t]===true)){if(o.functions[t]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:i,obj:n&&n.id?n.id:false,par:r&&r.id?r.id:false})}}return o.functions[t]}if(u===false||e.isFunction(u)&&u.call(this,t,n,r,i,s)===false||u&&u[t]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:i,obj:n&&n.id?n.id:false,par:r&&r.id?r.id:false})};return false}return true},last_error:function(){return this._data.core.last_error},move_node:function(n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w;r=this.get_node(r);i=i===t?0:i;if(!r){return false}if(!i.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(r)){return this.load_node(r,function(){this.move_node(n,r,i,s,true)})}if(e.isArray(n)){n=n.reverse().slice();for(u=0,a=n.length;u<a;u++){this.move_node(n[u],r,i,s,o)}return true}n=n&&n.id?n:this.get_node(n);if(!n||n.id==="#"){return false}f=(n.parent||"#").toString();c=!i.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent);h=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id);p=!h||!h._id||this._id!==h._id;l=h&&h._id&&f&&h._model.data[f]&&h._model.data[f].children?e.inArray(n.id,h._model.data[f].children):-1;if(p){if(this.copy_node(n,r,i,s,o)){if(h){h.delete_node(n)}return true}return false}if(c.id==="#"){if(i==="before"){i="first"}if(i==="after"){i="last"}}switch(i){case"before":i=e.inArray(r.id,c.children);break;case"after":i=e.inArray(r.id,c.children)+1;break;case"inside":case"first":i=0;break;case"last":i=c.children.length;break;default:if(!i){i=0}break}if(i>c.children.length){i=c.children.length}if(!this.check("move_node",n,c,i,{core:true,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id})){this.settings.core.error.call(this,this._data.core.last_error);return false}if(n.parent===c.id){d=c.children.concat();v=e.inArray(n.id,d);if(v!==-1){d=e.vakata.array_remove(d,v);if(i>v){i--}}v=[];for(m=0,g=d.length;m<g;m++){v[m>=i?m+1:m]=d[m]}v[i]=n.id;c.children=v;this._node_changed(c.id);this.redraw(c.id==="#")}else{v=n.children_d.concat();v.push(n.id);for(m=0,g=n.parents.length;m<g;m++){d=[];w=h._model.data[n.parents[m]].children_d;for(y=0,b=w.length;y<b;y++){if(e.inArray(w[y],v)===-1){d.push(w[y])}}h._model.data[n.parents[m]].children_d=d}h._model.data[f].children=e.vakata.array_remove_item(h._model.data[f].children,n.id);for(m=0,g=c.parents.length;m<g;m++){this._model.data[c.parents[m]].children_d=this._model.data[c.parents[m]].children_d.concat(v)}d=[];for(m=0,g=c.children.length;m<g;m++){d[m>=i?m+1:m]=c.children[m]}d[i]=n.id;c.children=d;c.children_d.push(n.id);c.children_d=c.children_d.concat(n.children_d);n.parent=c.id;v=c.parents.concat();v.unshift(c.id);w=n.parents.length;n.parents=v;v=v.concat();for(m=0,g=n.children_d.length;m<g;m++){this._model.data[n.children_d[m]].parents=this._model.data[n.children_d[m]].parents.slice(0,w*-1);Array.prototype.push.apply(this._model.data[n.children_d[m]].parents,v)}this._node_changed(f);this._node_changed(c.id);this.redraw(f==="#"||c.id==="#")}if(s){s.call(this,n,c,i)}this.trigger("move_node",{node:n,parent:c.id,position:i,old_parent:f,old_position:l,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this});return true},copy_node:function(n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g;r=this.get_node(r);i=i===t?0:i;if(!r){return false}if(!i.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(r)){return this.load_node(r,function(){this.copy_node(n,r,i,s,true)})}if(e.isArray(n)){n=n.reverse().slice();for(u=0,a=n.length;u<a;u++){this.copy_node(n[u],r,i,s,o)}return true}n=n&&n.id?n:this.get_node(n);if(!n||n.id==="#"){return false}d=(n.parent||"#").toString();v=!i.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent);m=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id);g=!m||!m._id||this._id!==m._id;if(v.id==="#"){if(i==="before"){i="first"}if(i==="after"){i="last"}}switch(i){case"before":i=e.inArray(r.id,v.children);break;case"after":i=e.inArray(r.id,v.children)+1;break;case"inside":case"first":i=0;break;case"last":i=v.children.length;break;default:if(!i){i=0}break}if(i>v.children.length){i=v.children.length}if(!this.check("copy_node",n,v,i,{core:true,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id})){this.settings.core.error.call(this,this._data.core.last_error);return false}p=m?m.get_json(n,{no_id:true,no_data:true,no_state:true}):n;if(!p){return false}if(p.id===true){delete p.id}p=this._parse_model_from_json(p,v.id,v.parents.concat());if(!p){return false}l=this.get_node(p);if(n&&n.state&&n.state.loaded===false){l.state.loaded=false}f=[];f.push(p);f=f.concat(l.children_d);this.trigger("model",{nodes:f,parent:v.id});for(c=0,h=v.parents.length;c<h;c++){this._model.data[v.parents[c]].children_d=this._model.data[v.parents[c]].children_d.concat(f)}f=[];for(c=0,h=v.children.length;c<h;c++){f[c>=i?c+1:c]=v.children[c]}f[i]=l.id;v.children=f;v.children_d.push(l.id);v.children_d=v.children_d.concat(l.children_d);this._node_changed(v.id);this.redraw(v.id==="#");if(s){s.call(this,l,v,i)}this.trigger("copy_node",{node:l,original:n,parent:v.id,position:i,old_parent:d,old_position:m&&m._id&&d&&m._model.data[d]&&m._model.data[d].children?e.inArray(n.id,m._model.data[d].children):-1,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id,old_instance:m,new_instance:this});return l.id},cut:function(t){if(!t){t=this._data.core.selected.concat()}if(!e.isArray(t)){t=[t]}if(!t.length){return false}var n=[],o,u,a;for(u=0,a=t.length;u<a;u++){o=this.get_node(t[u]);if(o&&o.id&&o.id!=="#"){n.push(o)}}if(!n.length){return false}r=n;s=this;i="move_node";this.trigger("cut",{node:t})},copy:function(t){if(!t){t=this._data.core.selected.concat()}if(!e.isArray(t)){t=[t]}if(!t.length){return false}var n=[],o,u,a;for(u=0,a=t.length;u<a;u++){o=this.get_node(t[u]);if(o&&o.id&&o.id!=="#"){n.push(o)}}if(!n.length){return false}r=n;s=this;i="copy_node";this.trigger("copy",{node:t})},get_buffer:function(){return{mode:i,node:r,inst:s}},can_paste:function(){return i!==false&&r!==false},paste:function(e,t){e=this.get_node(e);if(!e||!i||!i.match(/^(copy_node|move_node)$/)||!r){return false}if(this[i](r,e,t)){this.trigger("paste",{parent:e.id,node:r,mode:i})}r=false;i=false;s=false},edit:function(t,n){t=this.get_node(t);if(!t){return false}if(this.settings.core.check_callback===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"};this.settings.core.error.call(this,this._data.core.last_error);return false}n=typeof n==="string"?n:t.text;this.set_text(t,"");t=this._open_to(t);var r=this._data.core.rtl,i=this.element.width(),s=t.children(".jstree-anchor"),o=e("<span>"),u=n,a=e("<"+"div />",{css:{position:"absolute",top:"-200px",left:r?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),f=e("<"+"input />",{value:u,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var n=o.children(".jstree-rename-input"),r=n.val();if(r===""){r=u}a.remove();o.replaceWith(s);o.remove();this.set_text(t,u);if(this.rename_node(t,e("<div></div>").text(r)[this.settings.core.force_text?"text":"html"]())===false){this.set_text(t,u)}},this),keydown:function(e){var t=e.which;if(t===27){this.value=u}if(t===27||t===13||t===37||t===38||t===39||t===40||t===32){e.stopImmediatePropagation()}if(t===27||t===13){e.preventDefault();this.blur()}},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){f.width(Math.min(a.text("pW"+this.value).width(),i))},keypress:function(e){if(e.which===13){return false}}}),l={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""};o.attr("class",s.attr("class")).append(s.contents().clone()).append(f);s.replaceWith(o);a.css(l);f.css(l).width(Math.min(a.text("pW"+f[0].value).width(),i))[0].select()},set_theme:function(t,n){if(!t){return false}if(n===true){var r=this.settings.core.themes.dir;if(!r){r=e.jstree.path+"/themes"}n=r+"/"+t+"/style.css"}if(n&&e.inArray(n,o)===-1){e("head").append("<"+'link rel="stylesheet" href="'+n+'" type="text/css" />');o.push(n)}if(this._data.core.themes.name){this.element.removeClass("jstree-"+this._data.core.themes.name)}this._data.core.themes.name=t;this.element.addClass("jstree-"+t);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive");this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){if(this._data.core.themes.variant){this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}this._data.core.themes.variant=e;if(e){this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=true;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=false;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){if(this._data.core.themes.stripes){this.hide_stripes()}else{this.show_stripes()}},show_dots:function(){this._data.core.themes.dots=true;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=false;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){if(this._data.core.themes.dots){this.hide_dots()}else{this.show_dots()}},show_icons:function(){this._data.core.themes.icons=true;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=false;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){if(this._data.core.themes.icons){this.hide_icons()}else{this.show_icons()}},set_icon:function(t,n){var r,i,s,o;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++){this.set_icon(t[r],n)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}o=t.icon;t.icon=n;s=this.get_node(t,true).children(".jstree-anchor").children(".jstree-themeicon");if(n===false){this.hide_icon(t)}else if(n===true){s.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel")}else if(n.indexOf("/")===-1&&n.indexOf(".")===-1){s.removeClass(o).css("background","");s.addClass(n+" jstree-themeicon-custom").attr("rel",n)}else{s.removeClass(o).css("background","");s.addClass("jstree-themeicon-custom").css("background","url('"+n+"') center center no-repeat").attr("rel",n)}return true},get_icon:function(e){e=this.get_node(e);return!e||e.id==="#"?false:e.icon},hide_icon:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++){this.hide_icon(t[n])}return true}t=this.get_node(t);if(!t||t==="#"){return false}t.icon=false;this.get_node(t,true).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return true},show_icon:function(t){var n,r,i;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++){this.show_icon(t[n])}return true}t=this.get_node(t);if(!t||t==="#"){return false}i=this.get_node(t,true);t.icon=i.length?i.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):true;if(!t.icon){t.icon=true}i.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return true}};e.vakata={};e.vakata.attributes=function(t,n){t=e(t)[0];var r=n?{}:[];if(t&&t.attributes){e.each(t.attributes,function(t,i){if(e.inArray(i.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1){return}if(i.nodeValue!==null&&e.trim(i.nodeValue)!==""){if(n){r[i.nodeName]=i.nodeValue}else{r.push(i.nodeName)}}})}return r};e.vakata.array_unique=function(e){var t=[],n,r,i;for(n=0,i=e.length;n<i;n++){for(r=0;r<=n;r++){if(e[n]===e[r]){break}}if(r===n){t.push(e[n])}}return t};e.vakata.array_remove=function(e,t,n){var r=e.slice((n||t)+1||e.length);e.length=t<0?e.length+t:t;e.push.apply(e,r);return e};e.vakata.array_remove_item=function(t,n){var r=e.inArray(n,t);return r!==-1?e.vakata.array_remove(t,r):t};var h=document.createElement("I");h.className="jstree-icon jstree-checkbox";e.jstree.defaults.checkbox={visible:true,three_state:true,whole_node:true,keep_selected_style:true,cascade:"",tie_selection:true};e.jstree.plugins.checkbox=function(t,n){this.bind=function(){n.bind.call(this);this._data.checkbox.uto=false;this._data.checkbox.selected=[];if(this.settings.checkbox.three_state){this.settings.checkbox.cascade="up+down+undetermined"}this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;if(!this.settings.checkbox.keep_selected_style){this.element.addClass("jstree-checkbox-no-clicked")}if(this.settings.checkbox.tie_selection){this.element.addClass("jstree-checkbox-selection")}},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1){this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this))}if(!this.settings.checkbox.tie_selection){this.element.on("model.jstree",e.proxy(function(e,t){var n=this._model.data,r=n[t.parent],i=t.nodes,s,o;for(s=0,o=i.length;s<o;s++){n[i[s]].state.checked=n[i[s]].original&&n[i[s]].original.state&&n[i[s]].original.state.checked;if(n[i[s]].state.checked){this._data.checkbox.selected.push(i[s])}}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1){this.element.on("model.jstree",e.proxy(function(t,n){var r=this._model.data,i=r[n.parent],s=n.nodes,o=[],u,a,f,l,c,h,p=this.settings.checkbox.cascade,d=this.settings.checkbox.tie_selection;if(p.indexOf("down")!==-1){if(i.state[d?"selected":"checked"]){for(a=0,f=s.length;a<f;a++){r[s[a]].state[d?"selected":"checked"]=true}this._data[d?"core":"checkbox"].selected=this._data[d?"core":"checkbox"].selected.concat(s)}else{for(a=0,f=s.length;a<f;a++){if(r[s[a]].state[d?"selected":"checked"]){for(l=0,c=r[s[a]].children_d.length;l<c;l++){r[r[s[a]].children_d[l]].state[d?"selected":"checked"]=true}this._data[d?"core":"checkbox"].selected=this._data[d?"core":"checkbox"].selected.concat(r[s[a]].children_d)}}}}if(p.indexOf("up")!==-1){for(a=0,f=i.children_d.length;a<f;a++){if(!r[i.children_d[a]].children.length){o.push(r[i.children_d[a]].parent)}}o=e.vakata.array_unique(o);for(l=0,c=o.length;l<c;l++){i=r[o[l]];while(i&&i.id!=="#"){u=0;for(a=0,f=i.children.length;a<f;a++){u+=r[i.children[a]].state[d?"selected":"checked"]}if(u===f){i.state[d?"selected":"checked"]=true;this._data[d?"core":"checkbox"].selected.push(i.id);h=this.get_node(i,true);if(h&&h.length){h.children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked")}}else{break}i=this.get_node(i.parent)}}}this._data[d?"core":"checkbox"].selected=e.vakata.array_unique(this._data[d?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,n){var r=n.node,i=this._model.data,s=this.get_node(r.parent),o=this.get_node(r,true),u,a,f,l,c=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;if(c.indexOf("down")!==-1){this._data[h?"core":"checkbox"].selected=e.vakata.array_unique(this._data[h?"core":"checkbox"].selected.concat(r.children_d));for(u=0,a=r.children_d.length;u<a;u++){l=i[r.children_d[u]];l.state[h?"selected":"checked"]=true;if(l&&l.original&&l.original.state&&l.original.state.undetermined){l.original.state.undetermined=false}}}if(c.indexOf("up")!==-1){while(s&&s.id!=="#"){f=0;for(u=0,a=s.children.length;u<a;u++){f+=i[s.children[u]].state[h?"selected":"checked"]}if(f===a){s.state[h?"selected":"checked"]=true;this._data[h?"core":"checkbox"].selected.push(s.id);l=this.get_node(s,true);if(l&&l.length){l.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}}else{break}s=this.get_node(s.parent)}}if(c.indexOf("down")!==-1&&o.length){o.find(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(e,t){var n=this.get_node("#"),r=this._model.data,i,s,o;for(i=0,s=n.children_d.length;i<s;i++){o=r[n.children_d[i]];if(o&&o.original&&o.original.state&&o.original.state.undetermined){o.original.state.undetermined=false}}},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,n){var r=n.node,i=this.get_node(r,true),s,o,u,a=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection;if(r&&r.original&&r.original.state&&r.original.state.undetermined){r.original.state.undetermined=false}if(a.indexOf("down")!==-1){for(s=0,o=r.children_d.length;s<o;s++){u=this._model.data[r.children_d[s]];u.state[f?"selected":"checked"]=false;if(u&&u.original&&u.original.state&&u.original.state.undetermined){u.original.state.undetermined=false}}}if(a.indexOf("up")!==-1){for(s=0,o=r.parents.length;s<o;s++){u=this._model.data[r.parents[s]];u.state[f?"selected":"checked"]=false;if(u&&u.original&&u.original.state&&u.original.state.undetermined){u.original.state.undetermined=false}u=this.get_node(r.parents[s],true);if(u&&u.length){u.children(".jstree-anchor").removeClass(f?"jstree-clicked":"jstree-checked")}}}u=[];for(s=0,o=this._data[f?"core":"checkbox"].selected.length;s<o;s++){if((a.indexOf("down")===-1||e.inArray(this._data[f?"core":"checkbox"].selected[s],r.children_d)===-1)&&(a.indexOf("up")===-1||e.inArray(this._data[f?"core":"checkbox"].selected[s],r.parents)===-1)){u.push(this._data[f?"core":"checkbox"].selected[s])}}this._data[f?"core":"checkbox"].selected=e.vakata.array_unique(u);if(a.indexOf("down")!==-1&&i.length){i.find(".jstree-anchor").removeClass(f?"jstree-clicked":"jstree-checked")}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1){this.element.on("delete_node.jstree",e.proxy(function(e,t){var n=this.get_node(t.parent),r=this._model.data,i,s,o,u,a=this.settings.checkbox.tie_selection;while(n&&n.id!=="#"){o=0;for(i=0,s=n.children.length;i<s;i++){o+=r[n.children[i]].state[a?"selected":"checked"]}if(o===s){n.state[a?"selected":"checked"]=true;this._data[a?"core":"checkbox"].selected.push(n.id);u=this.get_node(n,true);if(u&&u.length){u.children(".jstree-anchor").addClass(a?"jstree-clicked":"jstree-checked")}}else{break}n=this.get_node(n.parent)}},this)).on("move_node.jstree",e.proxy(function(t,n){var r=n.is_multi,i=n.old_parent,s=this.get_node(n.parent),o=this._model.data,u,a,f,l,c,h=this.settings.checkbox.tie_selection;if(!r){u=this.get_node(i);while(u&&u.id!=="#"){a=0;for(f=0,l=u.children.length;f<l;f++){a+=o[u.children[f]].state[h?"selected":"checked"]}if(a===l){u.state[h?"selected":"checked"]=true;this._data[h?"core":"checkbox"].selected.push(u.id);c=this.get_node(u,true);if(c&&c.length){c.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}}else{break}u=this.get_node(u.parent)}}u=s;while(u&&u.id!=="#"){a=0;for(f=0,l=u.children.length;f<l;f++){a+=o[u.children[f]].state[h?"selected":"checked"]}if(a===l){if(!u.state[h?"selected":"checked"]){u.state[h?"selected":"checked"]=true;this._data[h?"core":"checkbox"].selected.push(u.id);c=this.get_node(u,true);if(c&&c.length){c.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}}}else{if(u.state[h?"selected":"checked"]){u.state[h?"selected":"checked"]=false;this._data[h?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,u.id);c=this.get_node(u,true);if(c&&c.length){c.children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked")}}else{break}}u=this.get_node(u.parent)}},this))}};this._undetermined=function(){var t,n,r=this._model.data,i=this.settings.checkbox.tie_selection,s=this._data[i?"core":"checkbox"].selected,o=[],u=this;for(t=0,n=s.length;t<n;t++){if(r[s[t]]&&r[s[t]].parents){o=o.concat(r[s[t]].parents)}}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e=u.get_node(this),i;if(!e.state.loaded){if(e.original&&e.original.state&&e.original.state.undetermined&&e.original.state.undetermined===true){o.push(e.id);o=o.concat(e.parents)}}else{for(t=0,n=e.children_d.length;t<n;t++){i=r[e.children_d[t]];if(!i.state.loaded&&i.original&&i.original.state&&i.original.state.undetermined&&i.original.state.undetermined===true){o.push(i.id);o=o.concat(i.parents)}}}});o=e.vakata.array_unique(o);o=e.vakata.array_remove_item(o,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(t=0,n=o.length;t<n;t++){if(!r[o[t]].state[i?"selected":"checked"]){s=this.get_node(o[t],true);if(s&&s.length){s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}}}};this.redraw_node=function(t,r,i){t=n.redraw_node.call(this,t,r,i);if(t){var s,o,u=null;for(s=0,o=t.childNodes.length;s<o;s++){if(t.childNodes[s]&&t.childNodes[s].className&&t.childNodes[s].className.indexOf("jstree-anchor")!==-1){u=t.childNodes[s];break}}if(u){if(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked){u.className+=" jstree-checked"}u.insertBefore(h.cloneNode(false),u.childNodes[0])}}if(!i&&this.settings.checkbox.cascade.indexOf("undetermined")!==-1){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)}return t};this.show_checkboxes=function(){this._data.core.themes.checkboxes=true;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=false;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){if(this._data.core.themes.checkboxes){this.hide_checkboxes()}else{this.show_checkboxes()}};this.is_undetermined=function(t){t=this.get_node(t);var n=this.settings.checkbox.cascade,r,i,s=this.settings.checkbox.tie_selection,o=this._data[s?"core":"checkbox"].selected,u=this._model.data;if(!t||t.state[s?"selected":"checked"]===true||n.indexOf("undetermined")===-1||n.indexOf("down")===-1&&n.indexOf("up")===-1){return false}if(!t.state.loaded&&t.original.state.undetermined===true){return true}for(r=0,i=t.children_d.length;r<i;r++){if(e.inArray(t.children_d[r],o)!==-1||!u[t.children_d[r]].state.loaded&&u[t.children_d[r]].original.state.undetermined){return true}}return false};this.activate_node=function(t,r){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(r.target).hasClass("jstree-checkbox"))){r.ctrlKey=true}if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(r.target).hasClass("jstree-checkbox")){return n.activate_node.call(this,t,r)}if(this.is_checked(t)){this.uncheck_node(t,r)}else{this.check_node(t,r)}this.trigger("activate_node",{node:this.get_node(t)})};this.check_node=function(t,n){if(this.settings.checkbox.tie_selection){return this.select_node(t,false,true,n)}var r,i,s,o;if(e.isArray(t)){t=t.slice();for(i=0,s=t.length;i<s;i++){this.check_node(t[i],n)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}r=this.get_node(t,true);if(!t.state.checked){t.state.checked=true;this._data.checkbox.selected.push(t.id);if(r&&r.length){r.children(".jstree-anchor").addClass("jstree-checked")}this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:n})}};this.uncheck_node=function(t,n){if(this.settings.checkbox.tie_selection){return this.deselect_node(t,false,n)}var r,i,s;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++){this.uncheck_node(t[r],n)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}s=this.get_node(t,true);if(t.state.checked){t.state.checked=false;this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id);if(s.length){s.children(".jstree-anchor").removeClass("jstree-checked")}this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:n})}};this.check_all=function(){if(this.settings.checkbox.tie_selection){return this.select_all()}var e=this._data.checkbox.selected.concat([]),t,n;this._data.checkbox.selected=this._model.data["#"].children_d.concat();for(t=0,n=this._data.checkbox.selected.length;t<n;t++){if(this._model.data[this._data.checkbox.selected[t]]){this._model.data[this._data.checkbox.selected[t]].state.checked=true}}this.redraw(true);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection){return this.deselect_all()}var e=this._data.checkbox.selected.concat([]),t,n;for(t=0,n=this._data.checkbox.selected.length;t<n;t++){if(this._model.data[this._data.checkbox.selected[t]]){this._model.data[this._data.checkbox.selected[t]].state.checked=false}}this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:e})};this.is_checked=function(e){if(this.settings.checkbox.tie_selection){return this.is_selected(e)}e=this.get_node(e);if(!e||e.id==="#"){return false}return e.state.checked};this.get_checked=function(t){if(this.settings.checkbox.tie_selection){return this.get_selected(t)}return t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected};this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection){return this.get_top_selected(t)}var n=this.get_checked(true),r={},i,s,o,u;for(i=0,s=n.length;i<s;i++){r[n[i].id]=n[i]}for(i=0,s=n.length;i<s;i++){for(o=0,u=n[i].children_d.length;o<u;o++){if(r[n[i].children_d[o]]){delete r[n[i].children_d[o]]}}}n=[];for(i in r){if(r.hasOwnProperty(i)){n.push(i)}}return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n};this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection){return this.get_bottom_selected(t)}var n=this.get_checked(true),r=[],i,s;for(i=0,s=n.length;i<s;i++){if(!n[i].children.length){r.push(n[i].id)}}return t?e.map(r,e.proxy(function(e){return this.get_node(e)},this)):r}};e.jstree.defaults.contextmenu={select_node:true,show_at_node:true,items:function(t,n){return{create:{separator_before:false,separator_after:true,_disabled:false,label:"Create",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.create_node(r,{},"last",function(e){setTimeout(function(){n.edit(e)},0)})}},rename:{separator_before:false,separator_after:false,_disabled:false,label:"Rename",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.edit(r)}},remove:{separator_before:false,icon:false,separator_after:false,_disabled:false,label:"Delete",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);if(n.is_selected(r)){n.delete_node(n.get_selected())}else{n.delete_node(r)}}},ccp:{separator_before:true,icon:false,separator_after:false,label:"Edit",action:false,submenu:{cut:{separator_before:false,separator_after:false,label:"Cut",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);if(n.is_selected(r)){n.cut(n.get_selected())}else{n.cut(r)}}},copy:{separator_before:false,icon:false,separator_after:false,label:"Copy",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);if(n.is_selected(r)){n.copy(n.get_selected())}else{n.copy(r)}}},paste:{separator_before:false,icon:false,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:false,label:"Paste",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.paste(r)}}}}}}};e.jstree.plugins.contextmenu=function(n,r){this.bind=function(){r.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e){e.preventDefault();t=e.ctrlKey?e.timeStamp:0;if(!this.is_loading(e.currentTarget)){this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)}},this)).on("click.jstree",".jstree-anchor",e.proxy(function(n){if(this._data.contextmenu.visible&&(!t||n.timeStamp-t>250)){e.vakata.context.hide()}},this));e(document).on("context_hide.vakata",e.proxy(function(){this._data.contextmenu.visible=false},this))};this.teardown=function(){if(this._data.contextmenu.visible){e.vakata.context.hide()}r.teardown.call(this)};this.show_contextmenu=function(n,r,i,s){n=this.get_node(n);if(!n||n.id==="#"){return false}var o=this.settings.contextmenu,u=this.get_node(n,true),a=u.children(".jstree-anchor"),f=false,l=false;if(o.show_at_node||r===t||i===t){f=a.offset();r=f.left;i=f.top+this._data.core.li_height}if(this.settings.contextmenu.select_node&&!this.is_selected(n)){this.activate_node(n,s)}l=o.items;if(e.isFunction(l)){l=l.call(this,n,e.proxy(function(e){this._show_contextmenu(n,r,i,e)},this))}if(e.isPlainObject(l)){this._show_contextmenu(n,r,i,l)}};this._show_contextmenu=function(t,n,r,i){var s=this.get_node(t,true),o=s.children(".jstree-anchor");e(document).one("context_show.vakata",e.proxy(function(t,n){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(n.element).addClass(r)},this));this._data.contextmenu.visible=true;e.vakata.context.show(o,{x:n,y:r},i);this.trigger("show_contextmenu",{node:t,x:n,y:r})}};(function(e){var t=false,n={element:false,reference:false,position_x:0,position_y:0,items:[],html:"",is_visible:false};e.vakata.context={settings:{hide_onmouseleave:0,icons:true},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_execute:function(t){t=n.items[t];return t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:n.reference,element:n.element}))&&t.action?t.action.call(null,{item:t,reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}}):false},_parse:function(t,r){if(!t){return false}if(!r){n.html="";n.items=[]}var i="",s=false,o;if(r){i+="<"+"ul>"}e.each(t,function(t,r){if(!r){return true}n.items.push(r);if(!s&&r.separator_before){i+="<"+"li class='vakata-context-separator'><"+"a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>"}s=false;i+="<"+"li class='"+(r._class||"")+(r._disabled===true||e.isFunction(r._disabled)&&r._disabled({item:r,reference:n.reference,element:n.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">";i+="<"+"a href='#' rel='"+(n.items.length-1)+"'>";if(e.vakata.context.settings.icons){i+="<"+"i ";if(r.icon){if(r.icon.indexOf("/")!==-1||r.icon.indexOf(".")!==-1){i+=" style='background:url(\""+r.icon+"\") center center no-repeat' "}else{i+=" class='"+r.icon+"' "}}i+="><"+"/i><"+"span class='vakata-contextmenu-sep'>&#160;<"+"/span>"}i+=(e.isFunction(r.label)?r.label({item:t,reference:n.reference,element:n.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"<"+"/a>";if(r.submenu){o=e.vakata.context._parse(r.submenu,true);if(o){i+=o}}i+="<"+"/li>";if(r.separator_after){i+="<"+"li class='vakata-context-separator'><"+"a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>";s=true}});i=i.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");if(r){i+="</ul>"}if(!r){n.html=i;e.vakata.context._trigger("parse")}return i.length>10?i:false},_show_submenu:function(n){n=e(n);if(!n.length||!n.children("ul").length){return}var r=n.children("ul"),i=n.offset().left+n.outerWidth(),s=n.offset().top,o=r.width(),u=r.height(),a=e(window).width()+e(window).scrollLeft(),f=e(window).height()+e(window).scrollTop();if(t){n[i-(o+10+n.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left")}else{n[i+o+10>a?"addClass":"removeClass"]("vakata-context-right")}if(s+u+10>f){r.css("bottom","-1px")}r.show()},show:function(r,i,s){var o,u,a,f,l,c,h,p,d=true;if(n.element&&n.element.length){n.element.width("")}switch(d){case!i&&!r:return false;case!!i&&!!r:n.reference=r;n.position_x=i.x;n.position_y=i.y;break;case!i&&!!r:n.reference=r;o=r.offset();n.position_x=o.left+r.outerHeight();n.position_y=o.top;break;case!!i&&!r:n.position_x=i.x;n.position_y=i.y;break}if(!!r&&!s&&e(r).data("vakata_contextmenu")){s=e(r).data("vakata_contextmenu")}if(e.vakata.context._parse(s)){n.element.html(n.html)}if(n.items.length){u=n.element;a=n.position_x;f=n.position_y;l=u.width();c=u.height();h=e(window).width()+e(window).scrollLeft();p=e(window).height()+e(window).scrollTop();if(t){a-=u.outerWidth();if(a<e(window).scrollLeft()+20){a=e(window).scrollLeft()+20}}if(a+l+20>h){a=h-(l+20)}if(f+c+20>p){f=p-(c+20)}n.element.css({left:a,top:f}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover");n.is_visible=true;e.vakata.context._trigger("show")}},hide:function(){if(n.is_visible){n.element.hide().find("ul").hide().end().find(":focus").blur();n.is_visible=false;e.vakata.context._trigger("hide")}}};e(function(){t=e("body").css("direction")==="rtl";var r=false;n.element=e("<ul class='vakata-context'></ul>");n.element.on("mouseenter","li",function(t){t.stopImmediatePropagation();if(e.contains(this,t.relatedTarget)){return}if(r){clearTimeout(r)}n.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end();e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover");e.vakata.context._show_submenu(this)}).on("mouseleave","li",function(t){if(e.contains(this,t.relatedTarget)){return}e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover");if(e.vakata.context.settings.hide_onmouseleave){r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave)}}).on("click","a",function(t){t.preventDefault();if(!e(this).blur().parent().hasClass("vakata-context-disabled")&&e.vakata.context._execute(e(this).attr("rel"))!==false){e.vakata.context.hide()}}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup";t.preventDefault();e(t.currentTarget).trigger(t);break;case 37:if(n.is_visible){n.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus();t.stopImmediatePropagation();t.preventDefault()}break;case 38:if(n.is_visible){r=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();if(!r.length){r=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()}r.addClass("vakata-context-hover").children("a").focus();t.stopImmediatePropagation();t.preventDefault()}break;case 39:if(n.is_visible){n.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus();t.stopImmediatePropagation();t.preventDefault()}break;case 40:if(n.is_visible){r=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first();if(!r.length){r=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()}r.addClass("vakata-context-hover").children("a").focus();t.stopImmediatePropagation();t.preventDefault()}break;case 27:e.vakata.context.hide();t.preventDefault();break;default:break}}).on("keydown",function(e){e.preventDefault();var t=n.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();if(t.parent().not(".vakata-context-disabled")){t.mouseup()}}).appendTo("body");e(document).on("mousedown",function(t){if(n.is_visible&&!e.contains(n.element[0],t.target)){e.vakata.context.hide()}}).on("context_show.vakata",function(e,r){n.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");if(t){n.element.addClass("vakata-context-rtl").css("direction","rtl")}n.element.find("ul").hide().end()})})})(e);e.jstree.defaults.dnd={copy:true,open_timeout:500,is_draggable:true,check_while_dragging:true,always_copy:false,inside_pos:0};e.jstree.plugins.dnd=function(t,n){this.bind=function(){n.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(t){var n=this.get_node(t.target),r=this.is_selected(n)?this.get_selected().length:1;if(n&&n.id&&n.id!=="#"&&(t.which===1||t.type==="touchstart")&&(this.settings.dnd.is_draggable===true||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_selected(true):[n]))){this.element.trigger("mousedown.jstree");return e.vakata.dnd.start(t,{jstree:true,origin:this,obj:this.get_node(n,true),nodes:r>1?this.get_selected():[n.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget,true))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')}},this))}};e(function(){var t=false,n=false,r=false,i=e('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");e(document).bind("dnd_start.vakata",function(e,n){t=false}).bind("dnd_move.vakata",function(s,o){if(r){clearTimeout(r)}if(!o.data.jstree){return}if(o.event.target.id&&o.event.target.id==="jstree-marker"){return}var u=e.jstree.reference(o.event.target),a=false,f=false,l=false,c,h,p,d,v,m,g,y,b,w,E,S,x,T;if(u&&u._data&&u._data.dnd){i.attr("class","jstree-"+u.get_theme()+(u.settings.core.themes.responsive?" jstree-dnd-responsive":""));o.helper.children().attr("class","jstree-"+u.get_theme()+(u.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"]();if((o.event.target===u.element[0]||o.event.target===u.get_container_ul()[0])&&u.get_container_ul().children().length===0){g=true;for(y=0,b=o.data.nodes.length;y<b;y++){g=g&&u.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==u?o.data.origin.get_node(o.data.nodes[y]):o.data.nodes[y],"#","last",{dnd:true,ref:u.get_node("#"),pos:"i",is_multi:o.data.origin&&o.data.origin!==u,is_foreign:!o.data.origin});if(!g){break}}if(g){t={ins:u,par:"#",pos:"last"};i.hide();o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");return}}else{a=e(o.event.target).closest(".jstree-anchor");if(a&&a.length&&a.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){f=a.offset();l=o.event.pageY-f.top;p=a.height();if(l<p/3){m=["b","i","a"]}else if(l>p-p/3){m=["a","i","b"]}else{m=l>p/2?["i","a","b"]:["i","b","a"]}e.each(m,function(s,l){switch(l){case"b":c=f.left-6;h=f.top;d=u.get_parent(a);v=a.parent().index();break;case"i":x=u.settings.dnd.inside_pos;T=u.get_node(a.parent());c=f.left-2;h=f.top+p/2+1;d=T.id;v=x==="first"?0:x==="last"?T.children.length:Math.min(x,T.children.length);break;case"a":c=f.left-6;h=f.top+p;d=u.get_parent(a);v=a.parent().index()+1;break}g=true;for(y=0,b=o.data.nodes.length;y<b;y++){w=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node";E=v;if(w==="move_node"&&l==="a"&&o.data.origin&&o.data.origin===u&&d===u.get_parent(o.data.nodes[y])){S=u.get_node(d);if(E>e.inArray(o.data.nodes[y],S.children)){E-=1}}g=g&&(u&&u.settings&&u.settings.dnd&&u.settings.dnd.check_while_dragging===false||u.check(w,o.data.origin&&o.data.origin!==u?o.data.origin.get_node(o.data.nodes[y]):o.data.nodes[y],d,E,{dnd:true,ref:u.get_node(a.parent()),pos:l,is_multi:o.data.origin&&o.data.origin!==u,is_foreign:!o.data.origin}));if(!g){if(u&&u.last_error){n=u.last_error()}break}}if(g){if(l==="i"&&a.parent().is(".jstree-closed")&&u.settings.dnd.open_timeout){r=setTimeout(function(e,t){return function(){e.open_node(t)}}(u,a),u.settings.dnd.open_timeout)}t={ins:u,par:d,pos:l==="i"&&x==="last"&&v===0&&!u.is_loaded(T)?"last":v};i.css({left:c+"px",top:h+"px"}).show();o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");n={};m=true;return false}});if(m===true){return}}}}t=false;o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");i.hide()}).bind("dnd_scroll.vakata",function(e,n){if(!n.data.jstree){return}i.hide();t=false;n.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er")}).bind("dnd_stop.vakata",function(s,o){if(r){clearTimeout(r)}if(!o.data.jstree){return}i.hide();var u,a,f=[];if(t){for(u=0,a=o.data.nodes.length;u<a;u++){f[u]=o.data.origin?o.data.origin.get_node(o.data.nodes[u]):o.data.nodes[u];if(o.data.origin){f[u].instance=o.data.origin}}t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](f,t.par,t.pos)}else{u=e(o.event.target).closest(".jstree");if(u.length&&n&&n.error&&n.error==="check"){u=u.jstree(true);if(u){u.settings.core.error.call(this,n)}}}}).bind("keyup keydown",function(t,n){n=e.vakata.dnd._get();if(n.data&&n.data.jstree){n.helper.find(".jstree-copy:eq(0)")[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()}})});(function(e){var t={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,n){var r=e.vakata.dnd._get();r.event=n;e(document).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){if(t.helper){t.helper.remove()}if(t.scroll_i){clearInterval(t.scroll_i);t.scroll_i=false}t={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};e(document).off("mousemove touchmove",e.vakata.dnd.drag);e(document).off("mouseup touchend",e.vakata.dnd.stop)},_scroll:function(n){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t){if(t.scroll_i){clearInterval(t.scroll_i);t.scroll_i=false}return false}if(!t.scroll_i){t.scroll_i=setInterval(e.vakata.dnd._scroll,100);return false}if(n===true){return false}var r=t.scroll_e.scrollTop(),i=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(r+t.scroll_t*e.vakata.dnd.settings.scroll_speed);t.scroll_e.scrollLeft(i+t.scroll_l*e.vakata.dnd.settings.scroll_speed);if(r!==t.scroll_e.scrollTop()||i!==t.scroll_e.scrollLeft()){e.vakata.dnd._trigger("scroll",t.scroll_e)}},start:function(n,r,i){if(n.type==="touchstart"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]){n.pageX=n.originalEvent.changedTouches[0].pageX;n.pageY=n.originalEvent.changedTouches[0].pageY;n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(t.is_drag){e.vakata.dnd.stop({})}try{n.currentTarget.unselectable="on";n.currentTarget.onselectstart=function(){return false};if(n.currentTarget.style){n.currentTarget.style.MozUserSelect="none"}}catch(s){}t.init_x=n.pageX;t.init_y=n.pageY;t.data=r;t.is_down=true;t.element=n.currentTarget;t.target=n.target;t.is_touch=n.type==="touchstart";if(i!==false){t.helper=e("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})}e(document).bind("mousemove touchmove",e.vakata.dnd.drag);e(document).bind("mouseup touchend",e.vakata.dnd.stop);return false},drag:function(n){if(n.type==="touchmove"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]){n.pageX=n.originalEvent.changedTouches[0].pageX;n.pageY=n.originalEvent.changedTouches[0].pageY;n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(!t.is_down){return}if(!t.is_drag){if(Math.abs(n.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(n.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)){if(t.helper){t.helper.appendTo("body");t.helper_w=t.helper.outerWidth()}t.is_drag=true;e.vakata.dnd._trigger("start",n)}else{return}}var r=false,i=false,s=false,o=false,u=false,a=false,f=false,l=false,c=false,h=false;t.scroll_t=0;t.scroll_l=0;t.scroll_e=false;e(e(n.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),i=r.offset();if(this.scrollHeight>this.offsetHeight){if(i.top+r.height()-n.pageY<e.vakata.dnd.settings.scroll_proximity){t.scroll_t=1}if(n.pageY-i.top<e.vakata.dnd.settings.scroll_proximity){t.scroll_t=-1}}if(this.scrollWidth>this.offsetWidth){if(i.left+r.width()-n.pageX<e.vakata.dnd.settings.scroll_proximity){t.scroll_l=1}if(n.pageX-i.left<e.vakata.dnd.settings.scroll_proximity){t.scroll_l=-1}}if(t.scroll_t||t.scroll_l){t.scroll_e=e(this);return false}});if(!t.scroll_e){r=e(document);i=e(window);s=r.height();o=i.height();u=r.width();a=i.width();f=r.scrollTop();l=r.scrollLeft();if(s>o&&n.pageY-f<e.vakata.dnd.settings.scroll_proximity){t.scroll_t=-1}if(s>o&&o-(n.pageY-f)<e.vakata.dnd.settings.scroll_proximity){t.scroll_t=1}if(u>a&&n.pageX-l<e.vakata.dnd.settings.scroll_proximity){t.scroll_l=-1}if(u>a&&a-(n.pageX-l)<e.vakata.dnd.settings.scroll_proximity){t.scroll_l=1}if(t.scroll_t||t.scroll_l){t.scroll_e=r}}if(t.scroll_e){e.vakata.dnd._scroll(true)}if(t.helper){c=parseInt(n.pageY+e.vakata.dnd.settings.helper_top,10);h=parseInt(n.pageX+e.vakata.dnd.settings.helper_left,10);if(s&&c+25>s){c=s-50}if(u&&h+t.helper_w>u){h=u-(t.helper_w+2)}t.helper.css({left:h+"px",top:c+"px"})}e.vakata.dnd._trigger("move",n);return false},stop:function(n){if(n.type==="touchend"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]){n.pageX=n.originalEvent.changedTouches[0].pageX;n.pageY=n.originalEvent.changedTouches[0].pageY;n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(t.is_drag){e.vakata.dnd._trigger("stop",n)}else{if(n.type==="touchend"&&n.target===t.target){var r=setTimeout(function(){e(n.target).click()},100);e(n.target).one("click",function(){if(r){clearTimeout(r)}})}}e.vakata.dnd._clean();return false}}})(e);e.jstree.defaults.search={ajax:false,fuzzy:false,case_sensitive:false,show_only_matches:false,close_opened_onclear:true,search_leaves_only:false,search_callback:false};e.jstree.plugins.search=function(t,n){this.bind=function(){n.bind.call(this);this._data.search.str="";this._data.search.dom=e();this._data.search.res=[];this._data.search.opn=[];this.element.on("before_open.jstree",e.proxy(function(t,n){var r,i,s,o=this._data.search.res,u=[],a=e();if(o&&o.length){this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")));this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");if(this.settings.search.show_only_matches&&this._data.search.res.length){for(r=0,i=o.length;r<i;r++){u=u.concat(this.get_node(o[r]).parents)}u=e.vakata.array_remove_item(e.vakata.array_unique(u),"#");a=u.length?e(this.element[0].querySelectorAll("#"+e.map(u,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");a=a.add(this._data.search.dom);a.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this));if(this.settings.search.show_only_matches){this.element.on("search.jstree",function(t,n){if(n.nodes.length){e(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");n.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}).on("clear_search.jstree",function(t,n){if(n.nodes.length){e(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")}})}};this.search=function(t,n){if(t===false||e.trim(t.toString())===""){return this.clear_search()}t=t.toString();var r=this.settings.search,i=r.ajax?r.ajax:false,s=null,o=[],u=[],a,f;if(this._data.search.res.length){this.clear_search()}if(!n&&i!==false){if(e.isFunction(i)){return i.call(this,t,e.proxy(function(n){if(n&&n.d){n=n.d}this._load_nodes(!e.isArray(n)?[]:e.vakata.array_unique(n),function(){this.search(t,true)},true)},this))}else{i=e.extend({},i);if(!i.data){i.data={}}i.data.str=t;return e.ajax(i).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(i)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(n){if(n&&n.d){n=n.d}this._load_nodes(!e.isArray(n)?[]:e.vakata.array_unique(n),function(){this.search(t,true)},true)},this))}}this._data.search.str=t;this._data.search.dom=e();this._data.search.res=[];this._data.search.opn=[];s=new e.vakata.search(t,true,{caseSensitive:r.case_sensitive,fuzzy:r.fuzzy});e.each(this._model.data,function(e,n){if(n.text&&(r.search_callback&&r.search_callback.call(this,t,n)||!r.search_callback&&s.search(n.text).isMatch)&&(!r.search_leaves_only||n.state.loaded&&n.children.length===0)){o.push(e);u=u.concat(n.parents)}});if(o.length){u=e.vakata.array_unique(u);this._search_open(u);this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")));this._data.search.res=o;this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");if(this.settings.search.close_opened_onclear){this.close_node(this._data.search.opn,0)}this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=e()};this._search_open=function(t){var n=this;e.each(t.concat([]),function(r,i){if(i==="#"){return true}try{i=e("#"+i.replace(e.jstree.idregex,"\\$&"),n.element)}catch(s){}if(i&&i.length){if(n.is_closed(i)){n._data.search.opn.push(i[0].id);n.open_node(i,function(){n._search_open(t)},0)}}})}};(function(e){e.vakata.search=function(e,t,n){n=n||{};if(n.fuzzy!==false){n.fuzzy=true}e=n.caseSensitive?e:e.toLowerCase();var r=n.location||0,i=n.distance||100,s=n.threshold||.6,o=e.length,u,a,f,l;if(o>32){n.fuzzy=false}if(n.fuzzy){u=1<<o-1;a=function(){var t={},n=0;for(n=0;n<o;n++){t[e.charAt(n)]=0}for(n=0;n<o;n++){t[e.charAt(n)]|=1<<o-n-1}return t}();f=function(e,t){var n=e/o,s=Math.abs(r-t);if(!i){return s?1:n}return n+s/i}}l=function(t){t=n.caseSensitive?t:t.toLowerCase();if(e===t||t.indexOf(e)!==-1){return{isMatch:true,score:0}}if(!n.fuzzy){return{isMatch:false,score:1}}var i,l,c=t.length,h=s,p=t.indexOf(e,r),d,v,m=o+c,g,y,b,w,E,S=1,x=[];if(p!==-1){h=Math.min(f(0,p),h);p=t.lastIndexOf(e,r+o);if(p!==-1){h=Math.min(f(0,p),h)}}p=-1;for(i=0;i<o;i++){d=0;v=m;while(d<v){if(f(i,r+v)<=h){d=v}else{m=v}v=Math.floor((m-d)/2+d)}m=v;y=Math.max(1,r-v+1);b=Math.min(r+v,c)+o;w=new Array(b+2);w[b+1]=(1<<i)-1;for(l=b;l>=y;l--){E=a[t.charAt(l-1)];if(i===0){w[l]=(w[l+1]<<1|1)&E}else{w[l]=(w[l+1]<<1|1)&E|((g[l+1]|g[l])<<1|1)|g[l+1]}if(w[l]&u){S=f(i,l-1);if(S<=h){h=S;p=l-1;x.push(p);if(p>r){y=Math.max(1,2*r-p)}else{break}}}}if(f(i+1,r)>h){break}g=w}return{isMatch:p>=0,score:S}};return t===true?{search:l}:l(t)}})(e);e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1};e.jstree.plugins.sort=function(t,n){this.bind=function(){n.bind.call(this);this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,true)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,false);this.redraw_node(t.parent||t.node.parent,true)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,false);this.redraw_node(t.parent,true)},this))};this.sort=function(t,n){var r,i;t=this.get_node(t);if(t&&t.children&&t.children.length){t.children.sort(e.proxy(this.settings.sort,this));if(n){for(r=0,i=t.children_d.length;r<i;r++){this.sort(t.children_d[r],false)}}}}};var p=false;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:false,filter:false};e.jstree.plugins.state=function(t,n){this.bind=function(){n.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){if(p){clearTimeout(p)}p=setTimeout(e.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",e.proxy(function(e,n){this.element.one("restore_state.jstree",t);if(!this.restore_state()){t()}},this))};this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+(new Date)};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))};this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(!!t){try{t=JSON.parse(t)}catch(n){return false}}if(!!t&&t.ttl&&t.sec&&+(new Date)-t.sec>t.ttl){return false}if(!!t&&t.state){t=t.state}if(!!t&&e.isFunction(this.settings.state.filter)){t=this.settings.state.filter.call(this,t)}if(!!t){this.element.one("set_state.jstree",function(n,r){r.instance.trigger("restore_state",{state:e.extend(true,{},t)})});this.set_state(t);return true}return false};this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}};(function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}})(e);e.jstree.defaults.types={"#":{},"default":{}};e.jstree.plugins.types=function(n,r){this.init=function(e,n){var i,s;if(n&&n.types&&n.types["default"]){for(i in n.types){if(i!=="default"&&i!=="#"&&n.types.hasOwnProperty(i)){for(s in n.types["default"]){if(n.types["default"].hasOwnProperty(s)&&n.types[i][s]===t){n.types[i][s]=n.types["default"][s]}}}}}r.init.call(this,e,n);this._model.data["#"].type="#"};this.refresh=function(e){r.refresh.call(this,e);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,n){var r=this._model.data,i=n.nodes,s=this.settings.types,o,u,a="default";for(o=0,u=i.length;o<u;o++){a="default";if(r[i[o]].original&&r[i[o]].original.type&&s[r[i[o]].original.type]){a=r[i[o]].original.type}if(r[i[o]].data&&r[i[o]].data.jstree&&r[i[o]].data.jstree.type&&s[r[i[o]].data.jstree.type]){a=r[i[o]].data.jstree.type}r[i[o]].type=a;if(r[i[o]].icon===true&&s[a].icon!==t){r[i[o]].icon=s[a].icon}}r["#"].type="#"},this));r.bind.call(this)};this.get_json=function(t,n,i){var s,o,u=this._model.data,a=n?e.extend(true,{},n,{no_id:false}):{},f=r.get_json.call(this,t,a,i);if(f===false){return false}if(e.isArray(f)){for(s=0,o=f.length;s<o;s++){f[s].type=f[s].id&&u[f[s].id]&&u[f[s].id].type?u[f[s].id].type:"default";if(n&&n.no_id){delete f[s].id;if(f[s].li_attr&&f[s].li_attr.id){delete f[s].li_attr.id}}}}else{f.type=f.id&&u[f.id]&&u[f.id].type?u[f.id].type:"default";if(n&&n.no_id){f=this._delete_ids(f)}}return f};this._delete_ids=function(t){if(e.isArray(t)){for(var n=0,r=t.length;n<r;n++){t[n]=this._delete_ids(t[n])}return t}delete t.id;if(t.li_attr&&t.li_attr.id){delete t.li_attr.id}if(t.children&&e.isArray(t.children)){t.children=this._delete_ids(t.children)}return t};this.check=function(n,i,s,o,u){if(r.check.call(this,n,i,s,o,u)===false){return false}i=i&&i.id?i:this.get_node(i);s=s&&s.id?s:this.get_node(s);var a=i&&i.id?e.jstree.reference(i.id):null,f,l,c,h;a=a&&a._model&&a._model.data?a._model.data:null;switch(n){case"create_node":case"move_node":case"copy_node":if(n!=="move_node"||e.inArray(i.id,s.children)===-1){f=this.get_rules(s);if(f.max_children!==t&&f.max_children!==-1&&f.max_children===s.children.length){this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:i&&i.id?i.id:false,par:s&&s.id?s.id:false})};return false}if(f.valid_children!==t&&f.valid_children!==-1&&e.inArray(i.type,f.valid_children)===-1){this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:i&&i.id?i.id:false,par:s&&s.id?s.id:false})};return false}if(a&&i.children_d&&i.parents){l=0;for(c=0,h=i.children_d.length;c<h;c++){l=Math.max(l,a[i.children_d[c]].parents.length)}l=l-i.parents.length+1}if(l<=0||l===t){l=1}do{if(f.max_depth!==t&&f.max_depth!==-1&&f.max_depth<l){this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:i&&i.id?i.id:false,par:s&&s.id?s.id:false})};return false}s=this.get_node(s.parent);f=this.get_rules(s);l++}while(s)}break}return true};this.get_rules=function(e){e=this.get_node(e);if(!e){return false}var n=this.get_type(e,true);if(n.max_depth===t){n.max_depth=-1}if(n.max_children===t){n.max_children=-1}if(n.valid_children===t){n.valid_children=-1}return n};this.get_type=function(t,n){t=this.get_node(t);return!t?false:n?e.extend({type:t.type},this.settings.types[t.type]):t.type};this.set_type=function(n,r){var i,s,o,u,a;if(e.isArray(n)){n=n.slice();for(s=0,o=n.length;s<o;s++){this.set_type(n[s],r)}return true}i=this.settings.types;n=this.get_node(n);if(!i[r]||!n){return false}u=n.type;a=this.get_icon(n);n.type=r;if(a===true||i[u]&&i[u].icon&&a===i[u].icon){this.set_icon(n,i[r].icon!==t?i[r].icon:true)}return true}};e.jstree.defaults.unique={case_sensitive:false,duplicate:function(e,t){return e+" ("+t+")"}};e.jstree.plugins.unique=function(n,r){this.check=function(t,n,i,s,o){if(r.check.call(this,t,n,i,s,o)===false){return false}n=n&&n.id?n:this.get_node(n);i=i&&i.id?i:this.get_node(i);if(!i||!i.children){return true}var u=t==="rename_node"?s:n.text,a=[],f=this.settings.unique.case_sensitive,l=this._model.data,c,h;for(c=0,h=i.children.length;c<h;c++){a.push(f?l[i.children[c]].text:l[i.children[c]].text.toLowerCase())}if(!f){u=u.toLowerCase()}switch(t){case"delete_node":return true;case"rename_node":c=e.inArray(u,a)===-1||n.text&&n.text[f?"toString":"toLowerCase"]()===u;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:false,par:i&&i.id?i.id:false})}}return c;case"create_node":c=e.inArray(u,a)===-1;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:false,par:i&&i.id?i.id:false})}}return c;case"copy_node":c=e.inArray(u,a)===-1;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:false,par:i&&i.id?i.id:false})}}return c;case"move_node":c=n.parent===i.id||e.inArray(u,a)===-1;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:false,par:i&&i.id?i.id:false})}}return c}return true};this.create_node=function(n,i,s,o,u){if(!i||i.text===t){if(n===null){n="#"}n=this.get_node(n);if(!n){return r.create_node.call(this,n,i,s,o,u)}s=s===t?"last":s;if(!s.toString().match(/^(before|after)$/)&&!u&&!this.is_loaded(n)){return r.create_node.call(this,n,i,s,o,u)}if(!i){i={}}var a,f,l,c,h,p=this._model.data,d=this.settings.unique.case_sensitive,v=this.settings.unique.duplicate;f=a=this.get_string("New node");l=[];for(c=0,h=n.children.length;c<h;c++){l.push(d?p[n.children[c]].text:p[n.children[c]].text.toLowerCase())}c=1;while(e.inArray(d?f:f.toLowerCase(),l)!==-1){f=v.call(this,a,++c).toString()}i.text=f}return r.create_node.call(this,n,i,s,o,u)}};var d=document.createElement("DIV");d.setAttribute("unselectable","on");d.className="jstree-wholerow";d.innerHTML="&#160;";e.jstree.plugins.wholerow=function(t,n){this.bind=function(){n.bind.call(this);this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n=false,r,i;for(r=0,i=t.selected.length;r<i;r++){n=this.get_node(t.selected[r],true);if(n&&n.length){n.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}}},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,true).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){this.get_node(t.node,true).children(".jstree-wholerow")[e.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var n=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){e.stopImmediatePropagation();this.hover_node(e.currentTarget);return false},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))};this.teardown=function(){if(this.settings.wholerow){this.element.find(".jstree-wholerow").remove()}n.teardown.call(this)};this.redraw_node=function(t,r,i){t=n.redraw_node.call(this,t,r,i);if(t){var s=d.cloneNode(true);if(e.inArray(t.id,this._data.core.selected)!==-1){s.className+=" jstree-wholerow-clicked"}t.insertBefore(s,t.childNodes[0])}return t}}})